<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>onSign · isomorphic-git</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="In order to use the PGP signing feature of [commit](/docs/en/next/commit), you have to provide a PGP signing callback like so:"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="onSign · isomorphic-git"/><meta property="og:type" content="website"/><meta property="og:url" content="https://isomorphic-git.org/"/><meta property="og:description" content="In order to use the PGP signing feature of [commit](/docs/en/next/commit), you have to provide a PGP signing callback like so:"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://isomorphic-git.org/img/favicon/android-chrome-192x192.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://isomorphic-git.org/blog/atom.xml" title="isomorphic-git Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://isomorphic-git.org/blog/feed.xml" title="isomorphic-git Blog RSS Feed"/><script type="text/javascript" src="/js/announcement.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/isomorphic-git-logo.svg" alt="isomorphic-git"/><h2 class="headerTitleWithLogo">isomorphic-git</h2></a><a href="/en/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/next/alphabetic" target="_self">API Docs</a></li><li class=""><a href="/docs/en/next/quickstart" target="_self">Guide</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/isomorphic-git/isomorphic-git" target="_self">GitHub</a></li><li class=""><a href="https://npmjs.com/package/isomorphic-git" target="_self">npm</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Callbacks</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">All Commands<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/alphabetic">Alphabetical Index</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Repository<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/init">init</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/clone">clone</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/commit">commit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/log">log</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fetch">fetch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/checkout">checkout</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/push">push</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/pull">pull</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fastForward">fastForward</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/merge">merge</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/walk">walk</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Callbacks<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/onAuth">onAuth</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/onAuthSuccess">onAuthSuccess</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/onAuthFailure">onAuthFailure</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/onMessage">onMessage</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/onProgress">onProgress</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/next/onSign">onSign</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/mergeDriver">mergeDriver</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Clients<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/fs">fs</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/http">http</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Config<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/setConfig">setConfig</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/getConfig">getConfig</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/getConfigAll">getConfigAll</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Branches<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/currentBranch">currentBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/branch">branch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/deleteBranch">deleteBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/renameBranch">renameBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listBranches">listBranches</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tags<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/tag">tag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/annotatedTag">annotatedTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/deleteTag">deleteTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listTags">listTags</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Files<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/add">add</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/remove">remove</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listFiles">listFiles</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/status">status</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/isIgnored">isIgnored</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/addNote">addNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/readNote">readNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/removeNote">removeNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listNotes">listNotes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Remotes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/getRemoteInfo">getRemoteInfo</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/getRemoteInfo2">getRemoteInfo2</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/addRemote">addRemote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/deleteRemote">deleteRemote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listRemotes">listRemotes</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/listServerRefs">listServerRefs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Objects<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/readBlob">readBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/readCommit">readCommit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/readTag">readTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/readTree">readTree</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeBlob">writeBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeCommit">writeCommit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeTag">writeTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeTree">writeTree</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/readObject">readObject</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeObject">writeObject</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Plumbing Commands<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/findRoot">findRoot</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/expandRef">expandRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/expandOid">expandOid</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/resetIndex">resetIndex</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/updateIndex">updateIndex</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/resolveRef">resolveRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/writeRef">writeRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/deleteRef">deleteRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/hashBlob">hashBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/statusMatrix">statusMatrix</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/isDescendent">isDescendent</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/indexPack">indexPack</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/packObjects">packObjects</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/version">version</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/isomorphic-git/isomorphic-git.github.io/edit/source/docs/onSign.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">onSign</h1></header><article><div><span><p>In order to use the PGP signing feature of <a href="/docs/en/next/commit">commit</a>, you have to provide a PGP signing callback like so:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> { pgp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@isomorphic-git/pgp-plugin'</span>
git.commit({ ..., <span class="hljs-attr">onSign</span>: pgp.sign })
</code></pre>
<p>You can choose between an <a href="https://github.com/isomorphic-git/openpgp-plugin">OpenPGP.js implementation</a> and an <a href="https://github.com/isomorphic-git/pgp-plugin">isomorphic-pgp implementation</a>!</p>
<p>OpenPGP (recommended for node apps)</p>
<ul>
<li>much wider support for different keys</li>
<li>LGPL (which probably means you can't bundle it into your application)</li>
<li>~164kb gzipped</li>
</ul>
<p>isomorphic-pgp (recommended for browser apps)</p>
<ul>
<li>limited types of keys supported</li>
<li>MIT</li>
<li>~21k gzipped</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="implementing-your-own-onsign-callback"></a><a href="#implementing-your-own-onsign-callback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementing your own <code>onSign</code> callback</h3>
<p>The PGP signing function must implement the following API:</p>
<h4><a class="anchor" aria-hidden="true" id="async-payload-secretkey-signature"></a><a href="#async-payload-secretkey-signature" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async ({ payload, secretKey }) =&gt; { signature }</h4>
<table>
<thead>
<tr><th>param</th><th>type [= default]</th><th>description</th></tr>
</thead>
<tbody>
<tr><td><strong>payload</strong></td><td>string</td><td>a plaintext message</td></tr>
<tr><td><strong>secretKey</strong></td><td>string</td><td>an 'ASCII armor' encoded PGP key (technically can actually contain <em>multiple</em> keys)</td></tr>
<tr><td>return</td><td>Promise&lt;{signature: string}&gt;</td><td>an 'ASCII armor' encoded &quot;detached&quot; signature</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="verifying-signatures"></a><a href="#verifying-signatures" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verifying Signatures</h2>
<p>To verify signed commits and signed annotated tag objects, you use the signature (<code>.gpgsig</code>) and the signing payload (<code>payload</code>) as returned from <code>log</code>, <code>readCommit</code>, or <code>readTag</code>.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Verify a whole bunch of commits</span>
<span class="hljs-keyword">import</span> { pgp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@isomorphic-git/pgp-plugin'</span>

<span class="hljs-keyword">let</span> commits = <span class="hljs-keyword">await</span> git.log({ fs, dir, <span class="hljs-attr">ref</span>: <span class="hljs-string">'main'</span> })
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { commit, payload } <span class="hljs-keyword">of</span> commits) {
  <span class="hljs-keyword">let</span> { valid, invalid } = <span class="hljs-keyword">await</span> pgp.verify({ payload, publicKey, <span class="hljs-attr">signature</span>: commit.gpgsig })
  <span class="hljs-comment">// valid is a string[] of the valid key ids</span>
  <span class="hljs-comment">// invalid is a string[] of the invalid key ids. Ideally this is empty.</span>
}
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Verify a commit object</span>
<span class="hljs-keyword">import</span> { pgp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@isomorphic-git/pgp-plugin'</span>

<span class="hljs-keyword">let</span> oid = <span class="hljs-keyword">await</span> git.resolveRef({ fs, dir, <span class="hljs-attr">ref</span>: <span class="hljs-string">'main'</span> })
<span class="hljs-keyword">let</span> { commit, payload } = <span class="hljs-keyword">await</span> git.readCommit({ fs, dir, oid })
<span class="hljs-keyword">let</span> { valid, invalid } = <span class="hljs-keyword">await</span> pgp.verify({ payload, publicKey, <span class="hljs-attr">signature</span>: commit.gpgsig })
<span class="hljs-comment">// valid is a string[] of the valid key ids</span>
<span class="hljs-comment">// invalid is a string[] of the invalid key ids</span>
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Verify an annotated tag object</span>
<span class="hljs-keyword">import</span> { pgp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@isomorphic-git/pgp-plugin'</span>
<span class="hljs-keyword">import</span> { resolveRef, readCommit } <span class="hljs-keyword">from</span> <span class="hljs-string">'isomorphic-git'</span>

<span class="hljs-keyword">let</span> oid = <span class="hljs-keyword">await</span> resolveRef({ fs, dir, <span class="hljs-attr">ref</span>: <span class="hljs-string">'v1.0.0'</span> })
<span class="hljs-keyword">let</span> { tag, payload } = <span class="hljs-keyword">await</span> readTag({ fs, dir, oid })
<span class="hljs-keyword">let</span> { valid, invalid } = <span class="hljs-keyword">await</span> pgp.verify({ payload, publicKey, <span class="hljs-attr">signature</span>: tag.signature })
<span class="hljs-comment">// valid is a string[] of the valid key ids</span>
<span class="hljs-comment">// invalid is a string[] of the invalid key ids</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="a-valid-signature-isnt-enough"></a><a href="#a-valid-signature-isnt-enough" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A valid signature isn't enough!</h3>
<p>Note that simply verifying the signatures are valid is not sufficient to establish <em>trust</em>.
You must also have reason to believe that the <code>publicKey</code> really does belong to the person who wrote the commit.
You must also have a way to find the <code>publicKey</code> in the first place!</p>
<p>So how <em>do</em> you get the <code>publicKey</code>? Here are two ways, each with serious drawbacks. (Spoiler: there's no standard solution yet.)</p>
<p>One thing you could do would be to use <code>commit.author.email</code> and <code>commit.committer.email</code>, match those to GitHub usernames (not a trivial task because their emails might be private), and then lookup the PGP key on GitHub. See <a href="https://www.npmjs.com/package/ghkeys"><code>ghkeys</code></a> for an implementation of username -&gt; PGP key lookup. The downside to this is, it only works for commits, signed by users, who have public emails on GitHub, who have uploaded their PGP keys on GitHub. But on the positive side, you can be pretty sure the PGP key really does belong to that user, because GitHub is acting as the authority. To be extra careful, I think GitHub's API lets you check whether the email address is a verified email address or not.</p>
<p>Another thing you could try is parse the PGP signature, extract the public key ID, and use the key ID to lookup the
public key on a PGP keyserver like mit.pgp.edu. (Some code to do just that follows this paragraph.) One downside to this is it only works if people bother to upload their key to a PGP keyserver. Another downside to this is there is absolutely no security. Anybody can upload a key claiming to be <code>johnsmith@aol.com</code> or whatever. If you look up the PGP key from the signature, you also need to make sure that the email address associated with the publicKey is the same one used in <code>commit.author.email</code> (or <code>commit.committer.email</code>). If you rely on a public keyserver where anyone can claim to be <code>johnsmith@aol.com</code>, then you'll need to exploit the Web-of-Trust (where keys are signed by other keys, which are signed by other keys, and so on until you reach a &quot;trusted key&quot;) or use some other way to decide keys are trustworthy.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> extractKey = <span class="hljs-function">(<span class="hljs-params">gpgsig</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> m = Message.parse(gpgsig);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">of</span> m.packets) {
    <span class="hljs-keyword">if</span> (p.tag === <span class="hljs-number">2</span> <span class="hljs-comment">/* Signature Packet */</span>) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> s <span class="hljs-keyword">of</span> p.packet.unhashed.subpackets) {
        <span class="hljs-keyword">if</span> (s.type === <span class="hljs-number">16</span> <span class="hljs-comment">/* Issuer */</span>) {
          <span class="hljs-keyword">return</span> s.subpacket.issuer_s
        }
      }
    }
  }
}

<span class="hljs-keyword">const</span> lookupKey = <span class="hljs-keyword">async</span> (keyid) =&gt; {
  <span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> (<span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`http://pgp.mit.edu/pks/lookup?op=get&amp;search=0x<span class="hljs-subst">${keyid}</span>`</span>)).text()
  <span class="hljs-keyword">let</span> matches = text.match(<span class="hljs-regexp">/-----BEGIN PGP PUBLIC KEY BLOCK-----(.|\n)*-----END PGP PUBLIC KEY BLOCK-----/</span>)
  <span class="hljs-keyword">if</span> (matches) <span class="hljs-keyword">return</span> matches[<span class="hljs-number">0</span>]
}
</code></pre>
<p>You could do a &quot;trust on first use&quot; strategy where the first time you see a signed commit by <code>johnsmith@aol.com</code> you lookup the public key and save it, and then in the future if a signed commit by <code>johnsmith@aol.com</code> uses a different key, show a warning to the user that the key has changed. (This is very similar to the strategy used by SSH - maybe you've seen the famous message <code>The authenticity of host &lt;IP ADDRESS&gt; can't be established. RSA key fingerprint is &lt;FINGERPRINT&gt;. Are you sure you want to continue connecting (yes/no)?</code>)</p>
<p>If you're making a more enterprisey, application, you could send the user an email and verify the email that way. You could store the PGP keys that you've verified in a centralized database.</p>
<p>Sadly, these two questions:</p>
<ul>
<li>Where do I find the public key?</li>
<li>Can I trust that the public key really belongs to this email address?</li>
</ul>
<p>have no simple answers. However, if you're building a decentralized system where you auto-generate PGP keys for users, I'd recommend saving the public PGP keys in the git repo itself. That seems like an obvious place.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/next/onProgress"><span class="arrow-prev">← </span><span class="function-name-prevnext">onProgress</span></a><a class="docs-next button" href="/docs/en/next/mergeDriver"><span class="function-name-prevnext">mergeDriver</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/isomorphic-git-logo.svg" alt="isomorphic-git" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/en/quickstart">Getting Started</a><a href="/docs/en/alphabetic">API Reference</a></div><div><h5>Community</h5><a href="/en/users">User Showcase</a><a href="https://gitter.im/isomorphic-git/Lobby">Project Chat</a><div><a href="https://github.com/isomorphic-git/isomorphic-git">GitHub <span id="gitHubStars"></span></a><script>
void async function() {
  const response = await fetch('https://api.github.com/repos/isomorphic-git/isomorphic-git', {
    headers: { accept: 'application/vnd.github.v3+json' }
  })
  const data = await response.json()
  document.querySelector('#gitHubStars').textContent = '(' + data.stargazers_count + '⭐)'
}()
</script></div></div><div><h5>More</h5><a href="/docs/en/in-the-news">In The News</a><a href="/blog">Blog</a></div></section><script type="text/javascript">let el = document.querySelector('.navListItemActive'); if (el) el.scrollIntoView({ block: 'nearest' })</script><script type="text/javascript" src="/js/gitter.js"></script><script type="text/javascript" src="/js/sidecar.v1.js"></script><script type="text/javascript" src="/js/codemirrorify.js"></script><script type="text/javascript" src="https://unpkg.com/@isomorphic-git/lightning-fs"></script><script type="text/javascript" src="/js/isomorphic-git/index.umd.min.js"></script><script type="module" src="/js/tutorial.js"></script><script type="module" src="/js/try-it-out-giturl.js"></script><script type="text/javascript" src="https://unpkg.com/@webcomponents/shadydom"></script><script type="text/javascript" src="/js/object-inspector.min.js"></script><script data-domain="isomorphic-git.org" src="https://plausible.io/js/plausible.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ac63b0df4513e31143eef156f520056c',
                indexName: 'isomorphic_git',
                inputSelector: '#search_input_react',
                algoliaOptions: {"typoTolerance":"min","facetFilters":["language:en","version:next"]}
              });
            </script></body></html>