<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Frequently Asked Questions · isomorphic-git</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## FAQ philosophy"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Frequently Asked Questions · isomorphic-git"/><meta property="og:type" content="website"/><meta property="og:url" content="https://isomorphic-git.org/"/><meta property="og:description" content="## FAQ philosophy"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://isomorphic-git.org/img/favicon/android-chrome-192x192.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://isomorphic-git.org/blog/atom.xml" title="isomorphic-git Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://isomorphic-git.org/blog/feed.xml" title="isomorphic-git Blog RSS Feed"/><script type="text/javascript" src="/js/announcement.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/isomorphic-git-logo.svg" alt="isomorphic-git"/><h2 class="headerTitleWithLogo">isomorphic-git</h2></a><a href="/en/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/next/alphabetic" target="_self">API Docs</a></li><li class="siteNavGroupActive"><a href="/docs/en/next/quickstart" target="_self">Guide</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/isomorphic-git/isomorphic-git" target="_self">GitHub</a></li><li class=""><a href="https://npmjs.com/package/isomorphic-git" target="_self">npm</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>More</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/quickstart">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/dir-vs-gitdir">dir vs gitdir</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/cli">isogit CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/cache">cache</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">More<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/next/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/snippets">Useful Snippets</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/webworker">WebWorker Example</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/isomorphic-git/isomorphic-git/edit/main/docs/faq.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Frequently Asked Questions</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="faq-philosophy"></a><a href="#faq-philosophy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FAQ philosophy</h2>
<p>Most frequently asked questions will get turned into code.
For instance, <a href="/docs/currentBranch.html">&quot;How to get the current branch?&quot;</a> and <a href="/docs/listFiles.html">&quot;How to list all the files in a commit?&quot;</a> used to be two frequently asked questions.
So this FAQ is kind of small</p>
<ul>
<li><a href="#faq-philosophy">FAQ philosophy</a></li>
<li><a href="#is-this-based-on-js-git">Is this based on <code>js-git</code>?</a></li>
<li><a href="#how-does-this-compare-with-nodegit">How does this compare with <code>nodegit</code>?</a></li>
<li><a href="#how-does-this-compare-with">How does this compare with...</a></li>
<li><a href="#why-is-there-no-default-export-in-the-es-module">Why is there no <code>default</code> export in the ES module?</a></li>
<li><a href="#how-to-add-all-untracked-files-with-gitadd">How to add all untracked files with git.add?</a></li>
<li><a href="#how-to-make-a-shallow-repository-unshallow">How to make a shallow repository unshallow?</a></li>
<li><a href="#does-it-support-wire-protocol-version-2">Does it support wire protocol version 2?</a></li>
<li><a href="#how-do-i-use-it-with-an-http-proxy">How do I use it with an HTTP proxy?</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="is-this-based-on-js-git"></a><a href="#is-this-based-on-js-git" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Is this based on <code>js-git</code>?</h2>
<p><em>Answer by Will Hilton (@wmhilton):</em></p>
<p>No, it is a rewrite from scratch. I basically wrote this library because I though js-git was a great idea but poorly designed for actual use.
This quote from the Q-Git documentation illustrates it best:</p>
<blockquote>
<p>JS-Git requires a certain amount of ceremony oweing to its many layers of configurability and code reuse.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">var</span> repo = {};
repo.rootPath = fs.join(__dirname, <span class="hljs-string">".."</span>, <span class="hljs-string">".git"</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"git-node-fs/mixins/fs-db"</span>)(repo, repo.rootPath);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'js-git/mixins/create-tree'</span>)(repo);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'js-git/mixins/pack-ops'</span>)(repo);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'js-git/mixins/walkers'</span>)(repo);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'js-git/mixins/read-combiner'</span>)(repo);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'js-git/mixins/formats'</span>)(repo);
</code></pre>
</blockquote>
<p>That is six different modules being required <em>just to open a repo</em>.
Implementation details, like <code>read-combiner</code> and <code>pack-ops</code> are exposed.
It is so hyper-modular that the ability to open a repo in a file system is not part of the core of <code>js-git</code> but requires you to install a second package called <code>git-node-fs</code>.</p>
<p>While <code>js-git</code> is extremely clever, it suffers from being too ahead of its time.
It was written in 2013, before async/await and even before Node streams were very good (I believe streams2 came out right about the time js-git started) and so the codebase uses something called 'continuables' and its own stream implementation called 'min-streams'.
So right off the bat, in order to begin using the code, you have to learn two new alien/outdated concepts.
And obviously this was written in ES5 because ES6 (aka ES2015) had not come out yet.
In the years since, js-git has not changed to keep up with the JavaScript language to take advantage of things like async/await, Promises, and streams.
There was enough interest in it though that <a href="https://github.com/creationix/js-git/issues/132">multiple projects</a> were spawned to create successors to js-git.
Isomorphic-git just happens to be the most mature successor.</p>
<h2><a class="anchor" aria-hidden="true" id="how-does-this-compare-with-nodegit"></a><a href="#how-does-this-compare-with-nodegit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How does this compare with <code>nodegit</code>?</h2>
<blockquote>
<p>How is isomorphic git different from nodegit?
I understand that nodegit is just a nodeJS binding for libgit, but apart from the implementation, how are these two different, and how do I choose between which to use?
Excluding the isomorphism</p>
</blockquote>
<p><em>Answer by Dan Allen (@mojavelinux) in the Gitter channel, reposted with permission:</em></p>
<p>As a current user of nodegit who is planning to migrate to isogit, I can offer some insight into this question.
First and foremost, isogit is pure JavaScript. this is no small thing. the single biggest obstacle to using the tool I built on nodegit (named Antora) is getting nodegit installed.
Nodegit is highly system dependent and really only works without modification on Windows (since binaries are made available) and Ubuntu after installing some packages.
All other versions of Linux require that you recompile libgit2 from scratch, which takes forever.
So do not ignore how much of a pain it will be for users or even developers if you choose nodegit.
Aside from that, nodegit can only operate on a full clone. isogit already offers many more efficient paths to getting information out of the repository because it only takes what it needs.
Authentication in nodegit is also quite a disaster, imho.
Basically, it's very system dependent and authentication errors can result in segfaults due to overzealous assertions in the libgit2 C code.
Don't get me wrong, nodegit is very powerful. it offers a pretty complete git experience thanks to the fact that it uses libgit2 under the covers.
But it has a lot of warts, from installation to incomplete mapping...and I think the most viable strategy for a Node project is to be using something that is pure JavaScript...hence my personal interest and recommendation for isogit.
I'm counting the days until Antora can offer isogit as the primary git client. (i just haven't gotten around to integrating it yet).
What I like most about nodegit is probably the tree walker...that's a nice way to extract content out of a git branch.
But there's really nothing nodegit can do that isogit can't or won't be able to do...and I think isogit is in a position to be a lot more flexible since it's not coupled to another library (as nodegit is to libgit2).
I also find the isogit project to be much more friendly. @wmhilton is a great development lead.</p>
<h2><a class="anchor" aria-hidden="true" id="how-does-this-compare-with"></a><a href="#how-does-this-compare-with" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How does this compare with...</h2>
<p>Here's a collection of all the other JavaScript git libraries I can find.
I haven't had time to review them all.</p>
<ul>
<li><a href="https://github.com/mariusGundersen/es-git">https://github.com/mariusGundersen/es-git</a></li>
<li><a href="https://github.com/SamyPesse/gitkit-js">https://github.com/SamyPesse/gitkit-js</a></li>
<li><a href="https://github.com/MatrixAI/js-virtualgit">https://github.com/MatrixAI/js-virtualgit</a></li>
<li><a href="http://gitlet.maryrosecook.com/docs/gitlet.html">http://gitlet.maryrosecook.com/docs/gitlet.html</a> &lt;-- one of my favorites!</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="why-is-there-no-default-export-in-the-es-module"></a><a href="#why-is-there-no-default-export-in-the-es-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why is there no <code>default</code> export in the ES module?</h2>
<blockquote>
<p>I've noticed that ES6 import of the the module requires import * as git from 'isomorphic-git'.
It seems that there's no default export which should just contain all the functions
I'm suggesting to have a default export that gathers all the functions together.</p>
</blockquote>
<p>In 0.x.x I withheld adding a <code>default</code> export for the reasons explained below. However in 1.x.x there <em>is</em> a default export - with a caveat!
The CommonJS format does <em>not</em> have a default export. This actually makes the most sense because it means this Just Works (TM):</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> git = <span class="hljs-built_in">require</span>(<span class="hljs-string">'isomorphic-git'</span>)
</code></pre>
<p>If you have a default export <em>and</em> a named export, Rollup spits out a file that has to be consumed like this...</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> git = <span class="hljs-built_in">require</span>(<span class="hljs-string">'isomorphic-git'</span>).default
</code></pre>
<p>which nobody wants.</p>
<p>To benefit from tree-shaking, you still should use named exports. But for convenience there is a default export now! So either of these work:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> git <span class="hljs-keyword">from</span> <span class="hljs-string">'isomorphic-git'</span>
<span class="hljs-comment">// or</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> git <span class="hljs-keyword">from</span> <span class="hljs-string">'isomorphic-git'</span>
</code></pre>
<p>which strays from my usual Pythonic &quot;there should only be one way to do it, and that way should be the best way&quot; attitude... but having a default export also makes using the library <em>simpler</em> because you don't have to think about whether to use a namespace import or a default import. And it looks nicer.</p>
<p>Old Answer preserved for posterity:</p>
<p><em>Answer by Will Hilton (@wmhilton):</em></p>
<p>Default exports are actually really bad for tree-shaking. If you do <code>import * as git from 'isomorphic-git'</code> and only use <code>git.log</code>, rollup and webpack are smart enough to only bundle <code>git.log</code>.
But if you do <code>import git from 'isomorphic-git'</code> then they can't do any tree-shaking, because you're importing an Object that could have interdependent functions and side effects.
Plus, if you export a default then the commonjs usage gets weird, because then you have to do <code>const git = require('git').default</code>
So I've concluded that <code>default</code> exports are simply a bad pattern, and I don't think anyone should ever use them.</p>
<p>I'll reconsider the matter once Node.js figures out how it is dealing with mixed ES6 imports and CJS requires.
But for now I think having a <code>default</code> export causes more harm than good - since the only good it does is save typing &quot;<code>* as</code>&quot; as far as I can tell.
But that is a VERY good question and one I spent a long time trying to figure out when I was researching how to design the module, and I remember being very disappointed at first when I discovered that <code>default</code> exports destroy tree-shaking.</p>
<h2><a class="anchor" aria-hidden="true" id="how-to-add-all-files-based-on-a-glob-pattern-with-gitadd"></a><a href="#how-to-add-all-files-based-on-a-glob-pattern-with-gitadd" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to add all files based on a glob pattern with git.add?</h2>
<blockquote>
<p>I want to add multiple files based on a pattern. How can I do this?</p>
</blockquote>
<p><em>Answer by Will Hilton (@wmhilton):</em></p>
<p>TLDR:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> globby = <span class="hljs-built_in">require</span>(<span class="hljs-string">'globby'</span>);
<span class="hljs-comment">// Add all .js files using the pattern "**/*.js" - adjust the</span>
<span class="hljs-comment">// pattern to suit your needs!</span>
<span class="hljs-keyword">const</span> paths = <span class="hljs-keyword">await</span> globby([<span class="hljs-string">'**/*.js'</span>], { <span class="hljs-attr">gitignore</span>: <span class="hljs-literal">true</span> });
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> filepath <span class="hljs-keyword">of</span> paths) {
    <span class="hljs-keyword">await</span> git.add({ fs, dir, filepath });
}
</code></pre>
<p>Long answer including a browser solution by @jcubic: <a href="https://github.com/isomorphic-git/isomorphic-git/issues/187">#187</a></p>
<h2><a class="anchor" aria-hidden="true" id="how-to-add-all-untracked-files-with-gitadd"></a><a href="#how-to-add-all-untracked-files-with-gitadd" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to add all untracked files with git.add?</h2>
<blockquote>
<p>I want to add all the files in a repository. How can I do this?</p>
</blockquote>
<p><em>Answer by @mtlewis:</em></p>
<p>If you want to add all the files in a repo, you can use the code below. The <code>dir</code> parameter should be set to the repository directory. Patterns in .gitignore will be respected, so ignored files should not be added by this command.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">await</span> git.add({ fs, dir, <span class="hljs-attr">filepath</span>: <span class="hljs-string">'.'</span> });
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="how-to-make-a-shallow-repository-unshallow"></a><a href="#how-to-make-a-shallow-repository-unshallow" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to make a shallow repository unshallow?</h2>
<blockquote>
<p>Is there an equivalent to <code>git fetch --unshallow</code>?</p>
</blockquote>
<p>The fast and dirty solution is just use really big depth, like <code>{depth: 1000000000}</code>.</p>
<p>What I would actually recommend would be the following:</p>
<ul>
<li>Start with <code>{ singleBranch: true, depth: 1 }</code></li>
<li>Then fetch with <code>{ depth: 100, relative: true }</code> which will grab the previous 100 commits</li>
<li>Then repeat fetching with <code>{ depth: 100, relative: true }</code> as needed until you have the full history.</li>
</ul>
<p>This gives you a well-behaved, paginated method for lengthening the git history as needed!</p>
<p>You can tell you have the full history indirectly by a couple of means... probably the easiest would just be <code>git.log</code> and when the array returned stops growing in length.
A slightly more efficient way of telling if you have the full history, would be to grab the oid from the last commit returned by <code>git.log</code> and use that as the starting point for the next call to <code>git.log</code> with <code>{ ref: oid }</code> and keep repeating until git.log only returns one commit. Or you could use the <code>'progress' event emitter</code> in <code>fetch</code> and if the fetch completed successfully with 0 progress events, I think that would indicate there's no more to fetch.</p>
<h2><a class="anchor" aria-hidden="true" id="does-it-support-wire-protocol-version-2"></a><a href="#does-it-support-wire-protocol-version-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Does it support wire protocol version 2?</h2>
<p>Not yet, but you can go <a href="https://github.com/isomorphic-git/isomorphic-git/issues/585">upvote the issue</a>
As soon as GitHub supports the <a href="https://git-scm.com/docs/protocol-v2#_fetch">fetch filter feature</a> I'll have a reason to work on it, because that would be extremely useful in browser environments!
But until then, there's no advantage to using the new protocol.</p>
<h2><a class="anchor" aria-hidden="true" id="how-do-i-use-it-with-an-http-proxy"></a><a href="#how-do-i-use-it-with-an-http-proxy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do I use it with an HTTP proxy?</h2>
<blockquote>
<p>I want to route HTTP requests through a proxy. How can I do this?</p>
</blockquote>
<p><em>Answer by Dan Allen (@mojavelinux):</em></p>
<p>isomorphic-git only supports a CORS proxy out of the box. However, all HTTP requests are handled by the http plugin. Therefore, you can swap out the http plugin with a wrapper to inject an HTTP or HTTPS agent that routes requests through the proxy.
This technique only works when using isomorphic-git on Node.js.</p>
<p>First, add the following dependencies to your project (or any HTTP agent that supports proxies that you prefer):</p>
<ul>
<li>hpagent</li>
</ul>
<p>Next, create a file named http-plugin.js and populate it with the following code:</p>
<pre><code class="hljs css language-js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">const</span> { <span class="hljs-attr">request</span>: delegate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'isomorphic-git/http/node'</span>)
<span class="hljs-keyword">const</span> { HttpProxyAgent, HttpsProxyAgent } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hpagent'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span> (<span class="hljs-params">{ url, method, headers, body }</span>) </span>{
  <span class="hljs-keyword">const</span> proxy = url.startsWith(<span class="hljs-string">'https:'</span>)
    ? { <span class="hljs-attr">Agent</span>: HttpsProxyAgent, <span class="hljs-attr">url</span>: process.env.https_proxy }
    : { <span class="hljs-attr">Agent</span>: HttpProxyAgent, <span class="hljs-attr">url</span>: process.env.http_proxy }
  <span class="hljs-keyword">const</span> agent = proxy.url ? <span class="hljs-keyword">new</span> proxy.Agent({ <span class="hljs-attr">proxy</span>: proxy.url }) : <span class="hljs-literal">undefined</span>
  <span class="hljs-keyword">return</span> delegate({ url, method, agent, headers, body })
}

<span class="hljs-built_in">module</span>.exports = { request }
</code></pre>
<p>Next, assign this plugin to the http variable instead of isomorphic-git/http/node:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./http-plugin.js'</span>)
</code></pre>
<p>Finally, pass this http variable to any command that requires the http keyword, such as clone:</p>
<pre><code class="hljs"><span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">git</span><span class="hljs-selector-class">.clone</span>({ ..<span class="hljs-selector-class">.repo</span>, <span class="hljs-selector-tag">url</span>, <span class="hljs-selector-tag">http</span> })
</code></pre>
<p>With this code in place, isomorphic-git will honor the <code>http_proxy</code> and <code>https_proxy</code> environment variables.
Those environment variables specify a URL through which to route HTTP and HTTPS connections, respectively.
The URL may contain a username and password if the proxy requires authentication.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/next/cache"><span class="arrow-prev">← </span><span>cache</span></a><a class="docs-next button" href="/docs/en/next/snippets"><span>Useful Snippets</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/isomorphic-git-logo.svg" alt="isomorphic-git" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/en/quickstart">Getting Started</a><a href="/docs/en/alphabetic">API Reference</a></div><div><h5>Community</h5><a href="/en/users">User Showcase</a><a href="https://gitter.im/isomorphic-git/Lobby">Project Chat</a><div><a href="https://github.com/isomorphic-git/isomorphic-git">GitHub <span id="gitHubStars"></span></a><script>
void async function() {
  const response = await fetch('https://api.github.com/repos/isomorphic-git/isomorphic-git', {
    headers: { accept: 'application/vnd.github.v3+json' }
  })
  const data = await response.json()
  document.querySelector('#gitHubStars').textContent = '(' + data.stargazers_count + '⭐)'
}()
</script></div></div><div><h5>More</h5><a href="/docs/en/in-the-news">In The News</a><a href="/blog">Blog</a></div></section><script type="text/javascript">let el = document.querySelector('.navListItemActive'); if (el) el.scrollIntoView({ block: 'nearest' })</script><script type="text/javascript" src="/js/gitter.js"></script><script type="text/javascript" src="/js/sidecar.v1.js"></script><script type="text/javascript" src="/js/codemirrorify.js"></script><script type="text/javascript" src="https://unpkg.com/@isomorphic-git/lightning-fs"></script><script type="text/javascript" src="/js/isomorphic-git/index.umd.min.js"></script><script type="module" src="/js/tutorial.js"></script><script type="module" src="/js/try-it-out-giturl.js"></script><script type="text/javascript" src="https://unpkg.com/@webcomponents/shadydom"></script><script type="text/javascript" src="/js/object-inspector.min.js"></script><script data-domain="isomorphic-git.org" src="https://plausible.io/js/plausible.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ac63b0df4513e31143eef156f520056c',
                indexName: 'isomorphic_git',
                inputSelector: '#search_input_react',
                algoliaOptions: {"typoTolerance":"min","facetFilters":["language:en","version:next"]}
              });
            </script></body></html>