<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>WebWorker Guide · isomorphic-git</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="While `isomorphic-git` tries not to block the main thread, it still does on occasion."/><meta name="docsearch:version" content="0.77.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="WebWorker Guide · isomorphic-git"/><meta property="og:type" content="website"/><meta property="og:url" content="https://isomorphic-git.org/"/><meta property="og:description" content="While `isomorphic-git` tries not to block the main thread, it still does on occasion."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://isomorphic-git.org/img/favicon/android-chrome-192x192.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://isomorphic-git.org/blog/atom.xml" title="isomorphic-git Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://isomorphic-git.org/blog/feed.xml" title="isomorphic-git Blog RSS Feed"/><script type="text/javascript" src="/js/announcement.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/isomorphic-git-logo.svg" alt="isomorphic-git"/><h2 class="headerTitleWithLogo">isomorphic-git</h2></a><a href="/en/versions"><h3>0.77.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/0.77.0/alphabetic" target="_self">API Docs</a></li><li class="siteNavGroupActive"><a href="/docs/en/0.77.0/quickstart" target="_self">Guide</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/isomorphic-git/isomorphic-git" target="_self">GitHub</a></li><li class=""><a href="https://npmjs.com/package/isomorphic-git" target="_self">npm</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>More</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/quickstart">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/browser">Browser Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/fs">Bring Your Own FS</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/authentication">Authentication</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/cli">isogit CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/dir-vs-gitdir">dir vs gitdir</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">More<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/en/0.77.0/snippets">Useful Snippets</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/0.77.0/webworker">WebWorker Guide</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/isomorphic-git/isomorphic-git/edit/main/docs/guide-webworker.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">WebWorker Guide</h1></header><article><div><span><p>While <code>isomorphic-git</code> tries not to block the main thread, it still does on occasion.
This can cause your webapp to stutter or even freeze up briefly!
To achieve buttery smooth performance, you'll eventually want to move all your <code>isomorphic-git</code> usage off of the main thread.</p>
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>WebWorkers live in a separate operating system thread from the main JS thread and communicate using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage">worker.postMessage()</a> method.
Code in the worker thread does not have access to heap objects in the main thread.
So all objects sent via postMessage need to be serialized before being sent.
Technically, this is done using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">structured clone</a> algorithm.</p>
<p>What kinds of Objects can be sent using <code>postMessage</code>? Functions cannot. Therefore objects with methods cannot.
JSON objects can. <code>Date</code> objects and <code>RegExp</code> objects can. Also <code>Uint8Array</code> objects and <code>Map</code> objects and <code>Set</code> objects.
So basically the types of objects you can send to a worker are a superset of JSON but a subset of full JavaScript objects.
For convenience, throughout the rest of this document I will refer to objects that can be serialized via the structured clone algorithm as &quot;cloneable&quot; objects.</p>
<p>Because of foresight and planning, most <code>isomorphic-git</code> functions are:</p>
<ol>
<li>async</li>
<li>have a single, cloneable object as their argument.</li>
</ol>
<p>The plugins (excepting <code>fs</code> plugin) also follow this pattern.
This greatly simplifies the job of mapping <code>isomorphic-git</code> calls to a remote procedure call (RPC) API using <code>postMessage</code>.
If you already have a WebWorker in your project and a prefered way to communicating with it, then mapping <code>isomorphic-git</code> calls is easy.</p>
<p>If you don't already have a prefered WebWorker RPC solution, then the easiest way is to use the <a href="https://www.npmjs.com/package/magic-portal">MagicPortal</a> which was designed specifically for <code>isomorphic-git</code> so it's a perfect match!
The examples below will use MagicPortal.</p>
<h2><a class="anchor" aria-hidden="true" id="implementation"></a><a href="#implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation</h2>
<p>In the main thread, we acquire a proxy isomorphic-git we can use.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// main.js</span>
;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">"./worker.js"</span>)

  <span class="hljs-keyword">const</span> portal = <span class="hljs-keyword">new</span> MagicPortal(worker)
  <span class="hljs-comment">// Acquire it from the worker</span>
  <span class="hljs-keyword">const</span> git = <span class="hljs-keyword">await</span> portal.get(<span class="hljs-string">'git'</span>)
})();
</code></pre>
<p>In the worker, we expose <code>isomorphic-git</code> to the main thread.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// worker.js</span>
importScripts([
  <span class="hljs-string">"https://isomorphic-git.org/js/browserfs.js"</span>,
  <span class="hljs-string">"https://unpkg.com/isomorphic-git"</span>,
  <span class="hljs-string">"https://unpkg.com/magic-portal"</span>,
])

BrowserFS.configure({ <span class="hljs-attr">fs</span>: <span class="hljs-string">'IndexedDB'</span>, <span class="hljs-attr">options</span>: {} }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err)

  <span class="hljs-comment">// Initialize isomorphic-git</span>
  <span class="hljs-keyword">const</span> fs = BrowserFS.BFSRequire(<span class="hljs-string">'fs'</span>)
  git.plugins.set(<span class="hljs-string">'fs'</span>, fs)

  <span class="hljs-comment">// Expose it to the main thread</span>
  <span class="hljs-keyword">const</span> portal = <span class="hljs-keyword">new</span> MagicPortal(self);
  portal.set(<span class="hljs-string">'git'</span>, git)
})
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="plugins"></a><a href="#plugins" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plugins</h2>
<p>All plugins have to be setup in the worker, because the plugin functions have to live in the same thread as <code>isomorphic-git</code>.
Therefore, if your plugin needs to interact with the main thread, you have to ALSO proxy your plugin!</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> credentialManager = {
  <span class="hljs-keyword">async</span> fill({ url }) {
    <span class="hljs-keyword">let</span> username = <span class="hljs-built_in">window</span>.prompt(<span class="hljs-string">"Username:"</span>)
    <span class="hljs-keyword">let</span> password = <span class="hljs-built_in">window</span>.prompt(<span class="hljs-string">"Password:"</span>)
    <span class="hljs-keyword">return</span> { username, password }
  },
  <span class="hljs-keyword">async</span> approved({ url, auth }) {
    <span class="hljs-keyword">return</span>
  },
  <span class="hljs-keyword">async</span> rejected({ url, auth }) {
    <span class="hljs-built_in">window</span>.alert(<span class="hljs-string">'Authentication rejected'</span>)
    <span class="hljs-keyword">return</span>
  }
}
portal.set(<span class="hljs-string">'credentialManager'</span>, credentialManager, {<span class="hljs-attr">void</span>: [<span class="hljs-string">'approved'</span>, <span class="hljs-string">'rejected'</span>]})

</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// worker.js</span>
<span class="hljs-keyword">let</span> credentialManager = <span class="hljs-keyword">await</span> portal.get(<span class="hljs-string">'credentialManager'</span>)
git.plugins.set(<span class="hljs-string">'credentialManager'</span>, credentialManager)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<p>Here is a complete example that runs git in a WebWorker.
The worker exposes 'git' to the main thread, and the main thread exposes the 'emitter' and 'credentialManager' plugins (which need access to the DOM) to the worker.</p>
<p>Gist: <a href="https://gist.github.com/wmhilton/c311070034bc8d99e3e82d97636d0fd8">https://gist.github.com/wmhilton/c311070034bc8d99e3e82d97636d0fd8</a></p>
<iframe src="https://codesandbox.io/embed/kkpx6q162o?fontsize=13&module=%2Fworker.js" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/0.77.0/snippets"><span class="arrow-prev">← </span><span>Useful Snippets</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/isomorphic-git-logo.svg" alt="isomorphic-git" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/en/quickstart">Getting Started</a><a href="/docs/en/alphabetic">API Reference</a></div><div><h5>Community</h5><a href="/en/users">User Showcase</a><a href="https://gitter.im/isomorphic-git/Lobby">Project Chat</a><div><a href="https://github.com/isomorphic-git/isomorphic-git">GitHub <span id="gitHubStars"></span></a><script>
void async function() {
  const response = await fetch('https://api.github.com/repos/isomorphic-git/isomorphic-git', {
    headers: { accept: 'application/vnd.github.v3+json' }
  })
  const data = await response.json()
  document.querySelector('#gitHubStars').textContent = '(' + data.stargazers_count + '⭐)'
}()
</script></div></div><div><h5>More</h5><a href="/docs/en/in-the-news">In The News</a><a href="/blog">Blog</a></div></section><script type="text/javascript">let el = document.querySelector('.navListItemActive'); if (el) el.scrollIntoView({ block: 'nearest' })</script><script type="text/javascript" src="/js/gitter.js"></script><script type="text/javascript" src="/js/sidecar.v1.js"></script><script type="text/javascript" src="/js/codemirrorify.js"></script><script type="text/javascript" src="https://unpkg.com/@isomorphic-git/lightning-fs"></script><script type="text/javascript" src="/js/isomorphic-git/index.umd.min.js"></script><script type="module" src="/js/tutorial.js"></script><script type="module" src="/js/try-it-out-giturl.js"></script><script type="text/javascript" src="https://unpkg.com/@webcomponents/shadydom"></script><script type="text/javascript" src="/js/object-inspector.min.js"></script><script data-domain="isomorphic-git.org" src="https://plausible.io/js/plausible.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ac63b0df4513e31143eef156f520056c',
                indexName: 'isomorphic_git',
                inputSelector: '#search_input_react',
                algoliaOptions: {"typoTolerance":"min","facetFilters":["language:en","version:0.77.0"]}
              });
            </script></body></html>