<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>mergeDriver · isomorphic-git</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The merge driver is a callback which is called for each conflicting file during a merge. It takes the file contents on each branch as an array and returns the merged result."/><meta name="docsearch:version" content="1.x"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="mergeDriver · isomorphic-git"/><meta property="og:type" content="website"/><meta property="og:url" content="https://isomorphic-git.org/"/><meta property="og:description" content="The merge driver is a callback which is called for each conflicting file during a merge. It takes the file contents on each branch as an array and returns the merged result."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://isomorphic-git.org/img/favicon/android-chrome-192x192.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://isomorphic-git.org/blog/atom.xml" title="isomorphic-git Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://isomorphic-git.org/blog/feed.xml" title="isomorphic-git Blog RSS Feed"/><script type="text/javascript" src="/js/announcement.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/isomorphic-git-logo.svg" alt="isomorphic-git"/><h2 class="headerTitleWithLogo">isomorphic-git</h2></a><a href="/en/versions"><h3>1.x</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/alphabetic" target="_self">API Docs</a></li><li class=""><a href="/docs/en/quickstart" target="_self">Guide</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/isomorphic-git/isomorphic-git" target="_self">GitHub</a></li><li class=""><a href="https://npmjs.com/package/isomorphic-git" target="_self">npm</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Callbacks</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">All Commands<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/alphabetic">Alphabetical Index</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Repository<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/init">init</a></li><li class="navListItem"><a class="navItem" href="/docs/en/clone">clone</a></li><li class="navListItem"><a class="navItem" href="/docs/en/commit">commit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/log">log</a></li><li class="navListItem"><a class="navItem" href="/docs/en/fetch">fetch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/checkout">checkout</a></li><li class="navListItem"><a class="navItem" href="/docs/en/push">push</a></li><li class="navListItem"><a class="navItem" href="/docs/en/pull">pull</a></li><li class="navListItem"><a class="navItem" href="/docs/en/fastForward">fastForward</a></li><li class="navListItem"><a class="navItem" href="/docs/en/merge">merge</a></li><li class="navListItem"><a class="navItem" href="/docs/en/abortMerge">abortMerge</a></li><li class="navListItem"><a class="navItem" href="/docs/en/walk">walk</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Callbacks<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/onAuth">onAuth</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onAuthSuccess">onAuthSuccess</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onAuthFailure">onAuthFailure</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onMessage">onMessage</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onPostCheckout">onPostCheckout</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onPrePush">onPrePush</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onProgress">onProgress</a></li><li class="navListItem"><a class="navItem" href="/docs/en/onSign">onSign</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/mergeDriver">mergeDriver</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Clients<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/fs">fs</a></li><li class="navListItem"><a class="navItem" href="/docs/en/http">http</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Config<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/setConfig">setConfig</a></li><li class="navListItem"><a class="navItem" href="/docs/en/getConfig">getConfig</a></li><li class="navListItem"><a class="navItem" href="/docs/en/getConfigAll">getConfigAll</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Branches<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/currentBranch">currentBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/branch">branch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/deleteBranch">deleteBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/renameBranch">renameBranch</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listBranches">listBranches</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tags<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/tag">tag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/annotatedTag">annotatedTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/deleteTag">deleteTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listTags">listTags</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Files<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/add">add</a></li><li class="navListItem"><a class="navItem" href="/docs/en/remove">remove</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listFiles">listFiles</a></li><li class="navListItem"><a class="navItem" href="/docs/en/status">status</a></li><li class="navListItem"><a class="navItem" href="/docs/en/isIgnored">isIgnored</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/addNote">addNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/readNote">readNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/removeNote">removeNote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listNotes">listNotes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Remotes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/getRemoteInfo">getRemoteInfo</a></li><li class="navListItem"><a class="navItem" href="/docs/en/getRemoteInfo2">getRemoteInfo2</a></li><li class="navListItem"><a class="navItem" href="/docs/en/addRemote">addRemote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/deleteRemote">deleteRemote</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listRemotes">listRemotes</a></li><li class="navListItem"><a class="navItem" href="/docs/en/listServerRefs">listServerRefs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Objects<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/readBlob">readBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/readCommit">readCommit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/readTag">readTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/readTree">readTree</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeBlob">writeBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeCommit">writeCommit</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeTag">writeTag</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeTree">writeTree</a></li><li class="navListItem"><a class="navItem" href="/docs/en/readObject">readObject</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeObject">writeObject</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Plumbing Commands<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/findRoot">findRoot</a></li><li class="navListItem"><a class="navItem" href="/docs/en/expandRef">expandRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/expandOid">expandOid</a></li><li class="navListItem"><a class="navItem" href="/docs/en/resetIndex">resetIndex</a></li><li class="navListItem"><a class="navItem" href="/docs/en/updateIndex">updateIndex</a></li><li class="navListItem"><a class="navItem" href="/docs/en/resolveRef">resolveRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/writeRef">writeRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/deleteRef">deleteRef</a></li><li class="navListItem"><a class="navItem" href="/docs/en/hashBlob">hashBlob</a></li><li class="navListItem"><a class="navItem" href="/docs/en/statusMatrix">statusMatrix</a></li><li class="navListItem"><a class="navItem" href="/docs/en/isDescendent">isDescendent</a></li><li class="navListItem"><a class="navItem" href="/docs/en/indexPack">indexPack</a></li><li class="navListItem"><a class="navItem" href="/docs/en/packObjects">packObjects</a></li><li class="navListItem"><a class="navItem" href="/docs/en/version">version</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/isomorphic-git/isomorphic-git/edit/main/docs/mergeDriver.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">mergeDriver</h1></header><article><div><span><p>The merge driver is a callback which is called for each conflicting file during a merge. It takes the file contents on each branch as an array and returns the merged result.</p>
<p>By default the <a href="/docs/en/merge">merge</a> command uses the diff3 algorithm to try to solve merge conflicts, and throws an error if the conflict cannot be resolved. This is not always ideal, so isomorphic-git implements merge drivers so that users may implement their own merging algorithm.</p>
<p>A merge driver implements the following API:</p>
<h4><a class="anchor" aria-hidden="true" id="async-branches-contents-path-cleanmerge-mergedtext"></a><a href="#async-branches-contents-path-cleanmerge-mergedtext" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async ({ branches, contents, path }) =&gt; { cleanMerge, mergedText }</h4>
<table>
<thead>
<tr><th>param</th><th>type [= default]</th><th>description</th></tr>
</thead>
<tbody>
<tr><td>branches</td><td>Array&lt;string&gt;</td><td>an array of human readable branch names</td></tr>
<tr><td>contents</td><td>Array&lt;string&gt;</td><td>an array of the file's contents on each respective branch</td></tr>
<tr><td>path</td><td>string</td><td>the file's path relative to the git repository</td></tr>
<tr><td>return</td><td>Promise&lt;{cleanMerge: bool, mergedText: string}&gt;</td><td>Whether merge was successful, and the merged text</td></tr>
</tbody>
</table>
<p>If <code>cleanMerge</code> is true, then the <code>mergedText</code> string will be written to the file. If <code>cleanMerge</code> is false, a <code>MergeConflictError</code> will be thrown and no merge commit will be created.</p>
<p>If <code>merge</code> was called with <code>abortOnConflict: false</code>, the mergedText string will be written to the file even if there is a merge conflict. Otherwise, in the event of a merge conflict, no changes will be written to the worktree or index.</p>
<h3><a class="anchor" aria-hidden="true" id="mergedriverparams-path"></a><a href="#mergedriverparams-path" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MergeDriverParams#path</h3>
<p>The <code>path</code> parameter refers to the path of the conflicted file, relative to the root of the git repository.</p>
<h3><a class="anchor" aria-hidden="true" id="mergedriverparams-branches"></a><a href="#mergedriverparams-branches" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MergeDriverParams#branches</h3>
<p>The <code>branches</code> array contains the human-readable names of the branches we are merging. The first index refers to the merge base, the second refers to the branch being merged into, and any subsequent indexes refer to the branches we are merging. For example, say we have a git history that looks like this:</p>
<pre><code class="hljs">      A topic
     /
    D<span class="hljs-comment">---E main</span>
</code></pre>
<p>If we were to merge <code>topic</code> into <code>main</code>, the <code>branches</code> array would look like: <code>['base', 'main', 'topic']</code>. In this case, the name <code>base</code> refers to commit <code>D</code> which is the common ancestor of our two branches. <code>base</code> will always be the name at the first index.</p>
<h3><a class="anchor" aria-hidden="true" id="mergedriverparams-contents"></a><a href="#mergedriverparams-contents" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MergeDriverParams#contents</h3>
<p>The <code>contents</code> array contains the file contents respective of each branch. Like the <code>branches</code> array, the first index always refers to the merge base. The second index always refers to the branch we are merging into, i.e. 'ours'. Subsequent indexes refer to the branches we are merging, i.e. 'theirs'.</p>
<p>For example, say we have a file <code>text.txt</code> which contains:</p>
<pre><code class="hljs">original
<span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
</code></pre>
<p>On the <code>main</code> branch, we modify the text file to read:</p>
<pre><code class="hljs"><span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
was
modified
</code></pre>
<p>However, on the <code>topic</code> branch, we modify the text file to read:</p>
<pre><code class="hljs">modified
<span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
</code></pre>
<p>In this case, when our merge driver is called on <code>text.txt</code>, the <code>contents</code> array will look like this:</p>
<pre><code class="hljs css language-js">[
  <span class="hljs-string">'original\ntext\nfile'</span>,
  <span class="hljs-string">'text\n\file\nwas\nmodified'</span>,
  <span class="hljs-string">'modified\ntext\nfile'</span>,
]
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h2>
<p>Below is an example of a very simple merge driver which always chooses the other branch's version of the file whenever it was modified by both branches.</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> mergeDriver = <span class="hljs-function">(<span class="hljs-params">{ contents }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> mergedText = contents[<span class="hljs-number">2</span>]
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">cleanMerge</span>: <span class="hljs-literal">true</span>, mergedText }
}
</code></pre>
<p>If we applied this algorithm to the conflict in the previous example, the resolved file would simply read:</p>
<pre><code class="hljs">modified
<span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
</code></pre>
<p>and if instead we wanted to chose <em>our</em> branch's version of the file, whenever it was modified by both branches,we simply change the line:</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> mergedText = contents[<span class="hljs-number">2</span>]
</code></pre>
<p>to read:</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> mergedText = contents[<span class="hljs-number">1</span>]
</code></pre>
<p>which results in the resolved file reading:</p>
<pre><code class="hljs"><span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
was
modified
</code></pre>
<p>As a more complex example, we use the default diff3 algorithm, but choose the other branch's changes whenever specific lines of the file conflict.</p>
<pre><code class="hljs">const diff3Merge = require(<span class="hljs-string">'diff3'</span>)
const mergeDriver = ({ contents }) =&gt; {
  const baseContent = contents[<span class="hljs-number">0</span>]
  const ourContent = contents[<span class="hljs-number">1</span>]
  const theirContent = contents[<span class="hljs-number">2</span>]

  const LINEBREAKS = /^.*(\r?\n|$)/gm
  const ours = ourContent.match(LINEBREAKS)
  const base = baseContent.match(LINEBREAKS)
  const theirs = theirContent.match(LINEBREAKS)
  const result = diff3Merge(ours, base, theirs)
  let mergedText = <span class="hljs-string">''</span>
  <span class="hljs-keyword">for</span> (const item <span class="hljs-keyword">of</span> result) {
    <span class="hljs-keyword">if</span> (item.ok) {
      mergedText += item.ok.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
    }
    <span class="hljs-keyword">if</span> (item.<span class="hljs-keyword">conflict</span>) {
      mergedText += item.<span class="hljs-keyword">conflict</span>.b.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
    }
  }
  <span class="hljs-keyword">return</span> { cleanMerge: <span class="hljs-keyword">true</span>, mergedText }
}
</code></pre>
<p>If we apply this algorithm to the conflict in the previous example, the resolved file reads:</p>
<pre><code class="hljs">modified
<span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
was
modified
</code></pre>
<p>and if we wanted to choose <em>our</em> branch's changes whenever specific lines of the file conflict, we simply change the above line:</p>
<pre><code class="hljs">mergedText += item.<span class="hljs-keyword">conflict</span>.b.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
</code></pre>
<p>to read:</p>
<pre><code class="hljs">mergedText += item.<span class="hljs-keyword">conflict</span>.a.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
</code></pre>
<p>which results in a resolved file that reads:</p>
<pre><code class="hljs"><span class="hljs-built_in">text</span>
<span class="hljs-built_in">file</span>
was
modified
</code></pre>
<p>Finally, what if we wanted to make a slight modification to the behavior of the default merge driver, like changing the size of conflict markers? The code for the default merge driver is located in <code>src/utils/mergeFile.js</code>. We can copy the code into our merge driver like so:</p>
<pre><code class="hljs">const diff3Merge = require(<span class="hljs-string">'diff3'</span>)
const mergeDriver = ({ contents, branches }) =&gt; {
  const ourName = branches[<span class="hljs-number">1</span>]
  const theirName = branches[<span class="hljs-number">2</span>]

  const baseContent = contents[<span class="hljs-number">0</span>]
  const ourContent = contents[<span class="hljs-number">1</span>]
  const theirContent = contents[<span class="hljs-number">2</span>]

  const ours = ourContent.match(LINEBREAKS)
  const base = baseContent.match(LINEBREAKS)
  const theirs = theirContent.match(LINEBREAKS)

  const result = diff3Merge(ours, base, theirs)

  const markerSize = <span class="hljs-number">7</span>

  let mergedText = <span class="hljs-string">''</span>
  let cleanMerge = <span class="hljs-keyword">true</span>

  <span class="hljs-keyword">for</span> (const item <span class="hljs-keyword">of</span> result) {
    <span class="hljs-keyword">if</span> (item.ok) {
      mergedText += item.ok.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
    }
    <span class="hljs-keyword">if</span> (item.<span class="hljs-keyword">conflict</span>) {
      cleanMerge = <span class="hljs-keyword">false</span>
      mergedText += `${<span class="hljs-string">'&lt;'</span>.repeat(markerSize)} ${ourName}\n`
      mergedText += item.<span class="hljs-keyword">conflict</span>.a.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)

      mergedText += `${<span class="hljs-string">'='</span>.repeat(markerSize)}\n`
      mergedText += item.<span class="hljs-keyword">conflict</span>.b.<span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>)
      mergedText += `${<span class="hljs-string">'&gt;'</span>.repeat(markerSize)} ${theirName}\n`
    }
  }
  <span class="hljs-keyword">return</span> { cleanMerge, mergedText }
}
</code></pre>
<p>If we want larger conflict markers, we can simply change the line</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> markerSize = <span class="hljs-number">7</span>
</code></pre>
<p>to</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> markerSize = <span class="hljs-number">14</span>
</code></pre>
<p>Which will give us conflict markers that are 14 characters wide instead of the default 7.</p>
<p>Now if we use this merge driver when merging the branch 'topic' into 'main', and if we have <code>abortOnConflict</code> set to <code>false</code>, the worktree will be updated with a <code>text.txt</code> file that looks like this:</p>
<pre><code class="hljs">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; main
<span class="hljs-section">modified
==============</span>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; topic
text
file
was
modified
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/onSign"><span class="arrow-prev">← </span><span class="function-name-prevnext">onSign</span></a><a class="docs-next button" href="/docs/en/fs"><span>fs</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/isomorphic-git-logo.svg" alt="isomorphic-git" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/en/quickstart">Getting Started</a><a href="/docs/en/alphabetic">API Reference</a></div><div><h5>Community</h5><a href="/en/users">User Showcase</a><a href="https://gitter.im/isomorphic-git/Lobby">Project Chat</a><div><a href="https://github.com/isomorphic-git/isomorphic-git">GitHub <span id="gitHubStars"></span></a><script>
void async function() {
  const response = await fetch('https://api.github.com/repos/isomorphic-git/isomorphic-git', {
    headers: { accept: 'application/vnd.github.v3+json' }
  })
  const data = await response.json()
  document.querySelector('#gitHubStars').textContent = '(' + data.stargazers_count + '⭐)'
}()
</script></div></div><div><h5>More</h5><a href="/docs/en/in-the-news">In The News</a><a href="/blog">Blog</a></div></section><script type="text/javascript">let el = document.querySelector('.navListItemActive'); if (el) el.scrollIntoView({ block: 'nearest' })</script><script type="text/javascript" src="/js/gitter.js"></script><script type="text/javascript" src="/js/sidecar.v1.js"></script><script type="text/javascript" src="/js/codemirrorify.js"></script><script type="text/javascript" src="https://unpkg.com/@isomorphic-git/lightning-fs"></script><script type="text/javascript" src="/js/isomorphic-git/index.umd.min.js"></script><script type="module" src="/js/tutorial.js"></script><script type="module" src="/js/try-it-out-giturl.js"></script><script type="text/javascript" src="https://unpkg.com/@webcomponents/shadydom"></script><script type="text/javascript" src="/js/object-inspector.min.js"></script><script data-domain="isomorphic-git.org" src="https://plausible.io/js/plausible.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ac63b0df4513e31143eef156f520056c',
                indexName: 'isomorphic_git',
                inputSelector: '#search_input_react',
                algoliaOptions: {"typoTolerance":"min","facetFilters":["language:en","version:1.x"]}
              });
            </script></body></html>