<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Blog · isomorphic-git</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A pure JavaScript implementation of git for node and browsers!"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Blog · isomorphic-git"/><meta property="og:type" content="website"/><meta property="og:url" content="https://isomorphic-git.org/"/><meta property="og:description" content="A pure JavaScript implementation of git for node and browsers!"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://isomorphic-git.org/img/favicon/android-chrome-192x192.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://isomorphic-git.org/blog/atom.xml" title="isomorphic-git Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://isomorphic-git.org/blog/feed.xml" title="isomorphic-git Blog RSS Feed"/><script type="text/javascript" src="/js/announcement.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="blog"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/isomorphic-git-logo.svg" alt="isomorphic-git"/><h2 class="headerTitleWithLogo">isomorphic-git</h2></a><a href="/en/versions"><h3>1.x</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/alphabetic" target="_self">API Docs</a></li><li class=""><a href="/docs/en/quickstart" target="_self">Guide</a></li><li class="siteNavGroupActive siteNavItemActive"><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/isomorphic-git/isomorphic-git" target="_self">GitHub</a></li><li class=""><a href="https://npmjs.com/package/isomorphic-git" target="_self">npm</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2020/02/25/version-1-0-0">What is New in Version 1.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/23/isomorphic-git-dot-org-corporate-sponsors-and-a-new-CORS-proxy">isomorphic-git.org, corporate sponsors, and a new CORS proxy!</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/08/cors-proxy-origin-limited">CORS proxy origin limited</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/05/cors-proxy-disabled">CORS proxy temporarily disabled</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/04/07/gogs-adds-cors-headers-for-isomorphic-git">Gogs adds CORS headers for isomorphic-git</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="posts"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2020/02/25/version-1-0-0">What is New in Version 1.0</a></h1><p class="post-meta">February 25, 2020</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>Today marks the release of isomorphic-git version 1.0! 🎉 There are a lot of big improvements to celebrate.</p>
<ul>
<li><a href="#better-ide-integration">Better IDE Integration</a></li>
<li><a href="#better-typescript-integration">Better TypeScript Integration</a></li>
<li><a href="#more-good-defaults-fewer-bad-defaults">More Good Defaults, Fewer Bad Defaults</a></li>
<li><a href="#embrace-callbacks">Embrace Callbacks</a></li>
<li><a href="#future-proof-api">Future-proof API</a></li>
<li><a href="#acknowledgments">Acknowledgments</a></li>
<li><a href="#10-breaking-changes">1.0 Breaking Changes</a>
<ul>
<li><a href="#big-changes">Big changes</a></li>
<li><a href="#some-functions-have-been-renamed-or-removed">Some functions have been renamed or removed:</a></li>
<li><a href="#some-function-parameters-have-been-removed-or-replaced">Some function parameters have been removed or replaced:</a></li>
<li><a href="#the-return-types-of-some-functions-have-changed">The return types of some functions have changed:</a></li>
<li><a href="#some-function-behaviors-have-changed">Some function behaviors have changed</a></li>
<li><a href="#docs-and-dx-improvements">Docs and DX improvements</a></li>
<li><a href="#miscellaneous-stuff">Miscellaneous stuff</a></li>
</ul></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="better-ide-integration"></a><a href="#better-ide-integration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Better IDE Integration</h2>
<p>No longer must we maintain the <code>index.d.ts</code> file by hand!
Thanks to improvements in TS 3.7, we can auto-generate the declaration file using <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-7/#user-content---declaration-and--allowjs"><code>tsc --declaration --allowJs</code></a>.
This has the added benefit that the JSDoc is also included in the <code>index.d.ts</code> which leads to a much richer IDE integration. Sadly, parameter descriptions still aren't shown, but the main description body and the example code are!</p>
<p>Here's what the Visual Studio Code tooltip for <code>git.log</code> looked like before:</p>
<p><img src="/blog/assets/2020-02-25/tooltip-before.png" alt="v0.x.x tooltip"></p>
<p>And here's what it looks like in version 1.0:</p>
<p><img src="/blog/assets/2020-02-25/tooltip-after.png" alt="v1.x.x tooltip"></p>
<p>The functions themselves have been tweaked so that the <a href="https://github.com/isomorphic-git/isomorphic-git/blob/master/src/typedefs.js">core object interfaces</a> (<code>CommitObject</code>, <code>TreeEntry</code>, <code>TagObject</code>, etc) are reused wherever possible,
so that all the functions feel consistent and there are no surprises.
The result is a cleaner API where the documentation comes to you, right where you are.</p>
<h2><a class="anchor" aria-hidden="true" id="better-typescript-integration"></a><a href="#better-typescript-integration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Better TypeScript Integration</h2>
<p>The return types gel with TS better now. For example, <code>readObject</code> returns a &quot;discriminated union&quot; type, so you can take advantage of powerful type inference, like this:</p>
<p><img src="/blog/assets/2020-02-25/inference.png" alt="readObject type inference"></p>
<p>Exceptions are also well-typed now, so you can access their <code>.data</code> property with confidence:</p>
<p><img src="/blog/assets/2020-02-25/exceptions.png" alt="exception types"></p>
<h2><a class="anchor" aria-hidden="true" id="more-good-defaults-fewer-bad-defaults"></a><a href="#more-good-defaults-fewer-bad-defaults" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More Good Defaults, Fewer Bad Defaults</h2>
<p>A number of helpful behaviors that had to be opt-in before to preserve backwards compatibility are now the defaults.</p>
<ul>
<li>The <code>init</code> function doesn't overwrite your config file if it already exists.</li>
<li>The <code>checkout</code> function now warns about conflicts instead of blindly overwriting files.</li>
<li>The <code>commit</code> function doesn't silently remove submodules.</li>
</ul>
<p>:shudder: You live, you learn, amirite?</p>
<p>A number of &quot;helpful&quot; default behaviors have been removed, because no default is better than a bad default:</p>
<p>A big one was assuming if you if you used the ESM build you were in the browser and had access to <code>fetch</code> and if you used the CommonJS build you were in node.
That simply isn't true in today's environment.
In version 1.0, you are always in control of whether to use <code>http/web</code> or <code>http/node</code>.</p>
<p>Another one was automatically appending <code>.git</code> to the end of URLs when you clone them. That <em>can</em> be helpful, but it can also completely break cloning for some servers, which led to the awkward addition of the <code>noGitSuffix</code> parameter (cringe).
In version 1.0, the URL you give is the URL we GET.</p>
<h2><a class="anchor" aria-hidden="true" id="embrace-callbacks"></a><a href="#embrace-callbacks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Embrace Callbacks</h2>
<p>Something I tried to do early-ish in the development of 0.x was to move towards this idea that all function arguments need to be serializable.
My reasoning was this:</p>
<ol>
<li>isomorphic-git can be pretty slow and block the main thread.</li>
<li>I should encourage everyone to use isomorphic-git in a Worker.</li>
<li>Therefore, I should make it easy to wrap isomorphic-git in a postMessage / RPC interface.</li>
</ol>
<p>This led to the creation of <a href="https://www.npmjs.com/package/magic-portal"><code>magic-portal</code></a> and publishing the WebWorker Guide.
It also was the main constraint driving the design of the plugin system.
The idea was all the callbacks could be setup in one place.</p>
<p>However, since that time I have grown a tad wiser. In building real-world applications with isomorphic-git, I've realized:</p>
<ol>
<li><em>All</em> code can be pretty slow and block the main thread.</li>
<li>Therefore all the code that <em>uses</em> isomorphic-git should be in that Worker too.</li>
<li>In that case, isomorphic-git doesn't need serializable arguments at all.</li>
</ol>
<p>Therefore the plugin system and its awkward global state and funky namespace &quot;cores&quot; are gone, replaced by a vastly simpler collection of callback arguments.
The new code is safer, has better locality when you're reading it, and enables some cool new behaviors like canceling running functions and infinite retry for interactive authentication.</p>
<h2><a class="anchor" aria-hidden="true" id="future-proof-api"></a><a href="#future-proof-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Future-proof API</h2>
<p>A number of other changes, such as returning <code>Uint8Array</code> instead of <code>Buffer</code>, were done to pave the way for future refactoring.
The size of the library can be shrunk significantly if we drop the <code>Buffer</code> polyfill dependency.
Plus, Webpack 5 reportedly won't provide node polyfills automatically.</p>
<p>As always, all the functions are <code>async</code> and take named arguments, which makes adding new features without breaking old ones easy! I'm a huge fan of this pattern, and I think it's been very successful.</p>
<p>It is safe to say that the API for isomorphic-git will remain backwards compatible and have no breaking changes for at least a year, possibly two or three.
Because I want you to always be able to upgrade to the latest and greatest version of <code>isomorphic-git</code> without having to change any of your code.</p>
<p>Except for today. Today, we are making breaking changes because it is a major release.</p>
<h2><a class="anchor" aria-hidden="true" id="acknowledgments"></a><a href="#acknowledgments" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Acknowledgments</h2>
<p>A HUGE THANK YOU to <em>everyone</em> who used isomorphic-git 0.x.
You've been tremendously helpful, and you early adopters have helped make this project of mine fun and fulfilling!</p>
<p>And an even bigger thanks to <a href="https://github.com/isomorphic-git/isomorphic-git#contributors">everyone who contributed directly</a>!
Seeing other people help improve the codebase has warmed my heart.
And seeing your bug reports at least lets me know it is getting lots of use!</p>
<p>I'd like to thank a couple corporations, particularly <a href="https://cardstack.com/?utm_source=opencollective&amp;utm_medium=github&amp;utm_campaign=isomorphic-git">Cardstack</a>, <a href="https://www.clever-cloud.com/?utm_source=ref&amp;utm_medium=link&amp;utm_campaign=isomorphic-git">CleverCloud</a>, and <a href="https://opendevise.com/?utm_source=opencollective&amp;utm_medium=github&amp;utm_campaign=isomorphic-git">OpenDevise</a>.</p>
<p>Lastly, I'd like to thank <a href="https://stoplight.io/?utm_source=isomorphic-git&amp;utm_medium=isomorphic-git-blog&amp;utm_campaign=isomorphic-git">Stoplight, Inc</a> for hiring me and letting me work on isomorphic-git occasionally as part of my regular day job!
Everyone has benefitted from the bugfixes, perf, and usability enhancements that have resulted from our using isomorphic-git in our world-class API designer, Stoplight Studio.</p>
<hr>
<h2><a class="anchor" aria-hidden="true" id="10-breaking-changes"></a><a href="#10-breaking-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.0 Breaking Changes</h2>
<h3><a class="anchor" aria-hidden="true" id="big-changes"></a><a href="#big-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Big changes</h3>
<ul>
<li>The supported node &amp; browser versions have been bumped. (See beautiful table above.)</li>
<li>The plugin system has been eliminated and we're back to plain old dependency injection via function arguments! The plugin cores created a mysterious &quot;global state&quot; that makes it easy to trip up (I myself sometimes forgot to unset plugins after running tests). The old style of passing <code>fs</code> as a function argument was less aesthetic and more verbose, but it is a much simpler model than the plugin core model, and much safer because it makes it impossible for dependencies to accidentally share the default plugin core.
<ul>
<li>The <code>emitter</code> plugin has been replaced with <code>onMessage</code> and <code>onProgress</code> callbacks.</li>
<li>The <code>credentialManager</code> plugin has been replaced with <code>onAuth</code>, <code>onAuthFailure</code> and <code>onAuthSuccess</code> callbacks</li>
<li>The <code>fs</code> plugin has been replaced with an <code>fs</code> parameter.</li>
<li>The <code>http</code> plugin has been replaced with an <code>http</code> parameter.</li>
<li>The <code>pgp</code> plugin has been replaced with an <code>onSign</code> callback.</li>
</ul></li>
<li>There is an additional setup step to choose which <code>http</code> client to use, and functions that make HTTP requests have a new required <code>http</code> parameter. Previously I used a mix of bundler and runtime magic to try and pick between a build that used <code>fetch</code> and one that used <code>require('http')</code> but that didn't always work. For instance, if you were bundling a node application using Webpack, it would pick the wrong build <a href="https://github.com/isomorphic-git/isomorphic-git/issues/938">(#938)</a>. Another example: in an Electron renderer thread, <em>both</em> options could work (if the window is launched with <code>nodeIntegration: true</code>) but in a Web Worker thread only the fetch option should work (<em>unless</em> you have <code>nodeIntegrationInWorker: true</code> set). See &quot;Getting Started&quot; below to see the extra line of code you need.</li>
<li>The files in the package have been renamed so the import paths are short and sweet:
<ul>
<li><code>dist/bundle.umd.min.js</code> -&gt; <code>index.umd.min.js</code></li>
<li><code>dist/for-future/isomorphic-git/index.js</code> -&gt; <code>index.js</code> (the future has arrived)</li>
<li><code>dist/for-node/isomorphic-git/index.js</code> -&gt; <code>index.cjs</code></li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="some-functions-have-been-renamed-or-removed"></a><a href="#some-functions-have-been-renamed-or-removed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Some functions have been renamed or removed:</h3>
<ul>
<li>The <code>walkBeta2</code> function was renamed to <code>walk</code>.</li>
<li>The <code>walkBeta1</code> function was removed.</li>
<li>The <code>fastCheckout</code> function has been renamed <code>checkout</code> and the old <code>checkout</code> has been removed.</li>
<li>The (previously deprecated) <code>sign</code> function was removed.</li>
<li>The (previously deprecated) <code>utils.auth</code> function was removed.</li>
<li>The (previously deprecated) <code>utils.oauth2</code> was removed.</li>
<li>The <code>config</code> function has been removed and replaced by <code>getConfig</code>, <code>getConfigAll</code>, and <code>setConfig</code>.</li>
<li>The <code>verify</code> function has been removed, but <code>log</code>, <code>readCommit</code>, and <code>readTag</code> all return the <code>gpgsig</code> and signing <code>payload</code> now. This actually makes verification simpler and more efficient, because it can be done in batch on <code>git.log</code> output and the <code>gpgsig</code> itself can be parsed and used to lookup the public key. See <a href="https://isomorphic-git.org/docs/en/onSign">onSign</a> for complete code examples.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="some-function-parameters-have-been-removed-or-replaced"></a><a href="#some-function-parameters-have-been-removed-or-replaced" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Some function parameters have been removed or replaced:</h3>
<ul>
<li>The undocumented parameter aliases <code>authUsername</code> and <code>authPassword</code> were removed.</li>
<li>The <code>emitter</code> parameter was removed and replaced with the <code>onMessage</code> and <code>onProgress</code> callbacks. (Note that <code>onMessage</code> emits un-trimmed strings, so you get those <code>\r</code>s.)</li>
<li>The <code>username</code>, <code>password</code>, <code>token</code>, and <code>oauth2format</code> parameters were removed and replaced with the <code>onAuth</code> callback.</li>
<li>The <code>fast</code> parameter of <code>pull</code> was removed, since there is no &quot;slow&quot; implementation anymore.</li>
<li>The <code>signing</code> parameter of <code>log</code> was removed, since <code>log</code> will always return a payload.</li>
<li>The <code>pattern</code> parameter was removed from <code>statusMatrix</code> and replaced with a new <code>filter</code> function. (This is so we can drop the dependencies on <code>globalyzer</code> and <code>globrex</code>.)</li>
<li>The <code>newSubmoduleBehavior</code> parameter was removed and is now the default and only behavior, because it makes much more sense to have non-destructive defaults!</li>
<li>The <code>noSubmodules</code> parameter was removed because with the new submodule behavior it is no longer necessary to print console warnings about how submodules aren't supported. (When submodule support IS added to isomorphic-git, it will be opt-in using <code>recurseSubmodules: true</code> or something like that.)</li>
<li>The <code>autoTranslateSSH</code> feature was removed, since it is trivial to implement your own version using just the <code>UnknownTransportError.data.suggestion</code></li>
<li>The <code>writeObject</code> function when used to write a tree now expects a plain array rather than an object with a property called <code>entries</code> which is the array. (This is so that argument to <code>writeObject</code> has the same shape as the arguments to <code>writeBlob</code>/<code>writeCommit</code>/<code>writeTag</code>/<code>writeTree</code>.)</li>
<li>The <code>noOverwrite</code> parameter was removed from <code>init</code> and is the new behavior.</li>
<li>The <code>author.date</code>, <code>committer.date</code>, <code>tagger.date</code> parameters were removed in favor of <code>author.timestamp</code>, <code>committer.timestamp</code>, <code>tagger.timestamp</code> in order to be clear about what is actually written and share the same shape as the return types in <code>readCommit</code>, <code>log</code>, and <code>readTag</code>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="the-return-types-of-some-functions-have-changed"></a><a href="#the-return-types-of-some-functions-have-changed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The return types of some functions have changed:</h3>
<ul>
<li>Functions that used to return <code>Buffer</code> objects now return <code>Uint8Array</code> objects. (This is so we can eventually remove all internal dependencies on the Buffer browser polyfill, which is quite heavy!)</li>
<li>The <code>log</code> function now returns an array of the same kind of objects that <code>readCommit</code> returns. (This change simplifies the type signature of <code>log</code> so we don't need function overloading; that function overloading was the one thing preventing me from auto-generating <code>index.d.ts</code>.)</li>
<li>The <code>readObject</code> function returns a proper discriminated union so TypeScript can infer the type of <code>.object</code> once you establish the value of <code>.format</code> and <code>.type</code>. Also <code>.object</code> has the same shape as as the return value of <code>readBlob</code>/<code>readCommit</code>/<code>readTag</code>/<code>readTree</code>. (Meaning trees are now plain arrays rather than objects with a <code>.entries</code> property that is the array.)</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="some-function-behaviors-have-changed"></a><a href="#some-function-behaviors-have-changed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Some function behaviors have changed</h3>
<ul>
<li>The <code>push</code> function now pushes to the remote tracking branch (rather than a branch with the same name) by default.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="docs-and-dx-improvements"></a><a href="#docs-and-dx-improvements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docs and DX improvements</h3>
<ul>
<li>The <code>docs/alphabetic.md</code> and function list in <code>README.md</code> are auto-generated from the filenames in <code>src/api</code>.</li>
<li>Nearly the entire docs website is auto-generated from the JSDoc actually so keeping the docs website and source code in sync is easier.</li>
<li>All the example code in JSDoc is now type-checked during CI tests.</li>
<li>The live code examples on the website are displayed in a full-blown mobile-friendly code editor (CodeMirror 6).</li>
<li>Each page with live code examples includes a code snippet at the bottom to reset the browser file system.</li>
<li>The Getting Started guide has been updated.</li>
<li>All the example code in JSDoc has been updated.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="miscellaneous-stuff"></a><a href="#miscellaneous-stuff" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Miscellaneous stuff</h3>
<ul>
<li>Update the README to recommend LightningFS rather than BrowserFS.</li>
<li>The <code>internal-apis</code> bundle is no longer included in the published package. That was only being built to run the unit tests.</li>
</ul>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/07/23/isomorphic-git-dot-org-corporate-sponsors-and-a-new-CORS-proxy">isomorphic-git.org, corporate sponsors, and a new CORS proxy!</a></h1><p class="post-meta">July 23, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>We have a new home on the web! Instead of <code>isomorphic-git.github.io</code> we now live at <code>isomorphic-git.org</code>. This change happened mostly because we needed our own domain name for…</p>
<p>…our new CORS proxy!</p>
<blockquote>
<p><a href="https://cors.isomorphic-git.org">https://cors.isomorphic-git.org</a> — sponsored by <a href="https://www.clever-cloud.com/?utm_source=ref&amp;utm_medium=link&amp;utm_campaign=isomorphic-git"><img height="50" style="vertical-align: middle; padding-left: 1em" src="https://www.clever-cloud.com/images/brand-assets/logos/clever-cloud-red.svg" alt="Clever Cloud"></a></p>
</blockquote>
<p>After hearing about our bandwidth billing <a href="/blog/2018/07/05/cors-proxy-disabled">misadventures</a>
with the previous CORS proxy, <a href="https://www.clever-cloud.com/?utm_source=ref&amp;utm_medium=link&amp;utm_campaign=isomorphic-git">Clever Cloud</a>
graciously stepped up to sponsor a CORS proxy for isomorphic-git users.
Thanks to their extremely intuitive Platform As A Service (PAAS), it literally
took less than 5 minutes from sign up to have an auto-scaling instance of <a href="https://github.com/isomorphic-git/cors-proxy"><code>@isomorphic-git/cors-proxy</code></a> deployed.
Thank you Clever Cloud for supporting open source and supporting isomorphic-git in particular!</p>
<p>As of today, you should be able to use <code>https://cors.isomorphic-git.org</code> as a CORS proxy for your own
isomorphic-git projects, wherever they are hosted.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/07/08/cors-proxy-origin-limited">CORS proxy origin limited</a></h1><p class="post-meta">July 8, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>See the <a href="/blog/2018/07/05/cors-proxy-disabled">previous post</a> for background.</p>
<h2><a class="anchor" aria-hidden="true" id="the-proxy-works-for-isomorphic-gitgithubio"></a><a href="#the-proxy-works-for-isomorphic-gitgithubio" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The proxy works for isomorphic-git.github.io</h2>
<p>A new proxy, <a href="https://cors.isomorphic-git.org">git-cors-proxy.now.sh</a>, has been set up so that the online demos in the API documentation and guide will work again.
However, this proxy has been limited to a) only handle legit git clone / fetch / push / getRemoteInfo requests and b) only accept requests from the <code>https://isomorphic-git.github.io</code> origin.
This means that you can use the proxy on this website, but you will need to run your own proxy to use isomorphic-git on your own website.</p>
<h2><a class="anchor" aria-hidden="true" id="the-proxy-might-work-for-some-other-websites-in-the-future"></a><a href="#the-proxy-might-work-for-some-other-websites-in-the-future" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The proxy MIGHT work for some other websites in the future</h2>
<p>This isn't a big deal for large projects where it is &quot;just one more docker container to run on our kubernetes cluster.&quot;
But it is a shame for smaller projects that may be interested in using <code>isomorphic-git</code> but are using static hosting, like Github Pages, and don't have the time/resources to run a dedicated proxy.
So I will gradually be whitelisting more domains on the proxy, as bandwidth permits.
Likely candidates are: <code>*.github.io</code>, <code>*.gitlab.io</code>, and <code>*.glitch.me</code>.
Open an <a href="https://github.com/isomorphic-git/isomorphic-git.github.io/issues/new">issue</a> if you have a suggestion for a domain that would greatly benefit from a free git CORS proxy.</p>
<h2><a class="anchor" aria-hidden="true" id="you-can-deploy-your-own-git-cors-proxy-for-your-site"></a><a href="#you-can-deploy-your-own-git-cors-proxy-for-your-site" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>You can deploy your own git-cors-proxy for your site</h2>
<p>If you are one of these bigger projects that need to run your own CORS proxy, it is not hard to run your own instance!
Because running <a href="https://www.npmjs.com/package/cors-buster">cors-buster</a> &quot;AS IS&quot; is likely to put you in a similar situation that we were in,
I recommend running the more refined <a href="https://www.npmjs.com/package/@isomorphic-git/cors-proxy">@isomorphic-git/cors-proxy</a> package,
which will let you limit the allowed CORS Origins using an environment variable and block requests that are not for git repositories.
It comes complete with a Dockerfile that makes it easy to deploy.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/07/05/cors-proxy-disabled">CORS proxy temporarily disabled</a></h1><p class="post-meta">July 5, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>Since the start of the isomorphic-git project, I have hosted an instance of <a href="https://www.npmjs.com/package/cors-buster">cors-buster proxy</a> to
get around the fact that none of the major git hosting sites use CORS headers
that would allow browsers to clone. This proxy is free, <a href="https://github.com/wmhilton/cors-buster">open source</a>, and
easy to <a href="https://www.npmjs.com/package/cors-buster">install</a>.</p>
<p>Unfortunately, this proxy also used a whopping 5 TERABYTES of bandwidth last month, and I got hit with a
$500 charge from my favorite hosting service ever <a href="https://zeit.co/now">now.sh</a>. (They say they are working
on making bandwidth usage more transparent... it would have been good to get a notification....)
Either a lot of cloning has been going on (which is GREAT!) or somebody has discovered the proxy can be abused.
Either way, paying $500/month is not within isomorphic-git's budget.</p>
<p>(You could change that! Sponsor us on <a href="https://opencollective.com/isomorphic-git">OpenCollective</a>!)</p>
<p>So for now I've had to suspend the proxy until I find time to write some spiffy bandwidth-limiting logic for it.</p>
<p>Don't let this stop you from playing with isomorphic-git! Clone <a href="https://github.com/wmhilton/cors-buster">https://github.com/wmhilton/cors-buster</a>, or npm install it, or
deploy your own instance on Now.</p>
<p><strong>Update: ZEIT has donated credit to cover this month's surprise bandwidth, plus some extra!</strong> Aren't they great?</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/04/07/gogs-adds-cors-headers-for-isomorphic-git">Gogs adds CORS headers for isomorphic-git</a></h1><p class="post-meta">April 7, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>The Go Git Service (<a href="https://gogs.io">gogs.io</a>) is already the &quot;easiest, fastest, and most painless way of setting up a self-hosted Git service.&quot;
And now because of a small <a href="https://github.com/gogits/gogs/pull/4970/files">pull request</a> that got accepted,
I am excited to announce that on 2018-03-31 with the release of <a href="https://github.com/gogits/gogs/releases/tag/v0.11.43">Gogs v0.11.43</a>,
Gogs became the first git server to fully support CORS with the Git Smart HTTP protocol!!
This means you can do <strong>cross-domain fetch and push</strong> operations in the browser using isomorphic-git
<strong>without using a proxy server</strong>.</p>
<p>To enable CORS, edit the Gogs main config file, <code>custom/conf/app.ini</code>, and add the following:</p>
<pre><code class="hljs css language-ini"><span class="hljs-section">[http]</span>
<span class="hljs-attr">ACCESS_CONTROL_ALLOW_ORIGIN</span> = *
</code></pre>
<p>Hopefully Gitlab, Bitbucket, and Github will follow suit, enabling a new generation of web applications that
interact directly with source code repositories. Until then, you can continue using <a href="https://cors-buster-tbgktfqyku.now.sh/">cors-buster</a>
to interact with these sites.</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/04/02/contributing-workflow">Contributing Workflow</a></h1><p class="post-meta">April 2, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>I have gotten questions along the lines of &quot;how do I get started working on the code&quot;?
So I thought I would walk through what my development process looks like.</p>
<p>Step one: Pick an issue.
Today I feel like knocking out an easy bug that I should already know how to fix.
I will work on <a href="https://github.com/isomorphic-git/isomorphic-git/issues/107">Error when committing without &quot;author&quot; #107</a>.</p>
<p>Step two: checkout the master branch and do &quot;git pull --ff-only&quot; to make sure I'm working on the latest code.
This is almost always necessary because the master branch is protected by robots and enforces a &quot;merge only&quot; policy, so you never push or work on the master branch directly.
(It gets updated through pull requests when they get merged.)</p>
<p>Step three: Create a new branch with a descriptive name.
I'm not feeling descriptive though so I'll break my own rule and just call the branch 'issue-107'.</p>
<p>Step four: Update the unit tests.
This is the Test Driven Development (TDD) part of the project.
90% of the time, and nearly 100% of the time for fixing bugs, I know what behavior I want to see in the end, even before I start coding.
In this case, I want attempting to make a commit without an author throw an error.</p>
<p>Here's what that test looks like.
It's in the &quot;<code>commit</code>&quot; function, so its tests go in the &quot;<code>__tests__/test-commit.js</code>&quot; file.
There is already a test for making a commit, so I'll copy and paste it and then modify it to assert it throws a specific error.</p>
<pre><code class="hljs css language-js">it(<span class="hljs-string">'throw error if missing author'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// Setup</span>
  <span class="hljs-keyword">let</span> { fs, dir, gitdir } = <span class="hljs-keyword">await</span> makeFixture(<span class="hljs-string">'test-commit'</span>)
  <span class="hljs-comment">// Test</span>
  <span class="hljs-keyword">let</span> error = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> sha = <span class="hljs-keyword">await</span> commit({
      fs,
      gitdir,
      <span class="hljs-attr">author</span>: {
        <span class="hljs-attr">email</span>: <span class="hljs-string">'mrtest@example.com'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1262356920</span>
      },
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Initial commit'</span>
    })
  } <span class="hljs-keyword">catch</span> (err) {
    error = err.message
  }
  expect(error).toBe(<span class="hljs-string">'Author name and email must be specified as an argument or in the .git/config file'</span>)
  <span class="hljs-comment">// reset for test 2</span>
  error = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> sha = <span class="hljs-keyword">await</span> commit({
      fs,
      gitdir,
      <span class="hljs-attr">author</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Mr. Test'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1262356920</span>
      },
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Initial commit'</span>
    })
  } <span class="hljs-keyword">catch</span> (err) {
    error = err.message
  }
  expect(error).toBe(<span class="hljs-string">'Author name and email must be specified as an argument or in the .git/config file'</span>)
})
</code></pre>
<p>Now I run <a href="https://facebook.github.io/jest/">jest</a> in watch mode, filtering against the &quot;commit&quot; test.
If I did it right, the test should fail.</p>
<pre><code class="hljs css language-sh">&gt; jest commit --watch
</code></pre>
<p>I forgot that the signed commit test with OpenPGP takes quite a while, and the &quot;listCommits&quot; test matches that filter too.
So it is 21 seconds before I get my lovely error:</p>
<pre><code class="hljs css language-sh"> PASS  __tests__\<span class="hljs-built_in">test</span>-listCommits.js (10.628s)
 FAIL  __tests__\<span class="hljs-built_in">test</span>-commit.js (20.085s)
  ● commit › throw error <span class="hljs-keyword">if</span> missing author

    expect(received).toBe(expected)

    Expected value to be (using Object.is):
      <span class="hljs-string">"Author name and email must be specified as an argument or in the .git/config file"</span>
    Received:
      <span class="hljs-string">"Cannot read property '_named' of undefined"</span>

      43 |     expect(error).toBe(<span class="hljs-string">'Author name and email must be specified as an argument or in the .git/config file'</span>)
      44 |     // reset <span class="hljs-keyword">for</span> <span class="hljs-built_in">test</span> 2
    &gt; 45 |     error = null
      46 |     try {
      47 |       <span class="hljs-built_in">let</span> sha = await commit({
      48 |         fs,

      at Object.it (__tests__/<span class="hljs-built_in">test</span>-commit.js:45:19)

Test Suites: 1 failed, 1 passed, 2 total
Tests:       1 failed, 3 passed, 4 total
Snapshots:   1 passed, 1 total
Time:        21.697s
Ran all <span class="hljs-built_in">test</span> suites matching /commit/i.
</code></pre>
<p>That does match the error described in the Github issue #107 though, so I'm on the right track.</p>
<p>I open up <code>src/commands/commit.js</code>.
The first thing I notice is a bunch of JSDoc, which is a shame because I quit using JSDoc in favor of documenting
on the <a href="https://isomorphic-git.github.io/docs/commit.html">website</a> using <a href="https://docusaurus.io/">docusaurus</a>.
I delete the JSDoc because having out-of-date documentation in the code is worse than having no documentation in the code.</p>
<p>The actual change is pretty simple:</p>
<pre><code class="hljs css language-js diff">  
  <span class="hljs-comment">// Fill in missing arguments with default values</span>
  <span class="hljs-keyword">if</span> (author === <span class="hljs-literal">undefined</span>) author = {}
  <span class="hljs-keyword">if</span> (author.name === <span class="hljs-literal">undefined</span>) {
    author.name = <span class="hljs-keyword">await</span> config({ fs, gitdir, <span class="hljs-attr">path</span>: <span class="hljs-string">'user.name'</span> })
  }
  <span class="hljs-keyword">if</span> (author.email === <span class="hljs-literal">undefined</span>) {
    author.email = <span class="hljs-keyword">await</span> config({ fs, gitdir, <span class="hljs-attr">path</span>: <span class="hljs-string">'user.email'</span> })
  }
+ <span class="hljs-keyword">if</span> (author.name === <span class="hljs-literal">undefined</span> || author.email === <span class="hljs-literal">undefined</span>) {
+   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Author name and email must be specified as an argument or in the .git/config file'</span>)
+ }
  
</code></pre>
<p>I hit File &gt; Save and presto:</p>
<pre><code class="hljs css language-sh"> PASS  __tests__\<span class="hljs-built_in">test</span>-listCommits.js
 FAIL  __tests__\<span class="hljs-built_in">test</span>-commit.js (10.565s)
  ● commit › throw error <span class="hljs-keyword">if</span> missing author

    expect(received).toBe(expected)

    Expected value to be (using Object.is):
      <span class="hljs-string">"Author name and email must be specified as an argument or in the .git/config file"</span>
    Received:
      <span class="hljs-string">"Cannot read property '_named' of undefined"</span>

      43 |     expect(error).toBe(<span class="hljs-string">'Author name and email must be specified as an argument or in the .git/config file'</span>)
      44 |     // reset <span class="hljs-keyword">for</span> <span class="hljs-built_in">test</span> 2
    &gt; 45 |     error = null
      46 |     try {
      47 |       <span class="hljs-built_in">let</span> sha = await commit({
      48 |         fs,

      at Object.it (__tests__/<span class="hljs-built_in">test</span>-commit.js:45:19)

Test Suites: 1 failed, 1 passed, 2 total
Tests:       1 failed, 3 passed, 4 total
Snapshots:   1 passed, 1 total
Time:        11.563s
Ran all <span class="hljs-built_in">test</span> suites matching /commit/i.
</code></pre>
<p>Really? Oh, right. I'd already <a href="https://github.com/isomorphic-git/isomorphic-git/issues/107#issuecomment-374827138">figured out</a>
that this bug stems from the config parser, not the commit function itself, as can be seen from the stack trace in the original bug report:</p>
<pre><code class="hljs css language-js">models.js:<span class="hljs-number">440</span> Uncaught (<span class="hljs-keyword">in</span> promise) <span class="hljs-built_in">TypeError</span>: Cannot read property <span class="hljs-string">'_named'</span> <span class="hljs-keyword">of</span> <span class="hljs-literal">undefined</span>
    at isNamedSection (models.js:<span class="hljs-number">440</span>)
    at GitConfig.get (models.js:<span class="hljs-number">460</span>)
    at config (commands.js:<span class="hljs-number">135</span>)
</code></pre>
<p>Right. To the config parser! In this case it is <em>not</em> in <code>src/commands/config.js</code> but in <code>src/models/GitConfig.js</code>.
(The stack trace says <code>models.js</code> instead of <code>GitConfig.js</code> because node is running the files compiled in <code>dist/for-node</code> which
have each folder <code>commands</code>, <code>managers</code>, <code>models</code>, and <code>utils</code> rolled up into standalone files.)</p>
<p>I look at <code>isNamedSection</code> first since the error starts there.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> isNamedSection = <span class="hljs-function"><span class="hljs-params">section</span> =&gt;</span> schema[section]._named
</code></pre>
<p>OK, so <code>schema[section]</code> must be undefined when section = &quot;user&quot;.
I do not want isNamedSection to ever throw...
(and here is where I think &quot;Maybe I really should use TypeScript...&quot; but bury the thought)...
so I will change that.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> isNamedSection = <span class="hljs-function"><span class="hljs-params">section</span> =&gt;</span> schema[section] &amp;&amp; schema[section]._named
</code></pre>
<p>Ctrl+S.</p>
<pre><code class="hljs css language-sh"> FAIL  __tests__\<span class="hljs-built_in">test</span>-commit.js (10.673s)
  ● commit › throw error <span class="hljs-keyword">if</span> missing author

    expect(received).toBe(expected)

    Expected value to be (using Object.is):
      <span class="hljs-string">"Author name and email must be specified as an argument or in the .git/config file"</span>
    Received:
      <span class="hljs-string">"Cannot read property 'name' of undefined"</span>
</code></pre>
<p>I can't say I wasn't expecting something like that.
I go look through the GitConfig.get method to find and fix the likely culprit:</p>
<pre><code class="hljs css language-js diff">  <span class="hljs-comment">// Cast value to correct type</span>
- <span class="hljs-keyword">let</span> fn = schema[section][key]
+ <span class="hljs-keyword">let</span> fn = schema[section] &amp;&amp; schema[section][key]
</code></pre>
<p>(Because <code>schema['user']['name']</code> would be <code>undefined['name']</code> resulting in &quot;Cannot read property 'name' of undefined&quot;.)</p>
<p>Ctrl+S.</p>
<pre><code class="hljs css language-sh"> PASS  __tests__\<span class="hljs-built_in">test</span>-listCommits.js
 PASS  __tests__\<span class="hljs-built_in">test</span>-commit.js (10.786s)

Test Suites: 2 passed, 2 total
Tests:       4 passed, 4 total
Snapshots:   1 passed, 1 total
Time:        11.797s, estimated 12s
Ran all <span class="hljs-built_in">test</span> suites matching /commit/i.
</code></pre>
<p>Alright! Tests pass, which means <code>GitConfig.get()</code> isn't throwing but returning undefined when the author is missing,
and therefore our guard in <code>commit.js</code> works and throws our helpful
'Author name and email must be specified as an argument or in the .git/config file' error.</p>
<p>I run Ctrl+C to kill jest, then <code>git diff</code> to review my changes.
They look good (I do not see any temporary changes that I made and forgot to remove) so I go ahead and commit.
I do not need to mention the issue # in the commit message, because I will have a chance to refine the commit
message later using the Squash and Merge button in the PR.
[Editor's Note: I probably <em>should</em> have included the issue # here.]</p>
<pre><code class="hljs css language-sh">&gt; git add -u
&gt; git commit -m <span class="hljs-string">'fix: Throw meaningful error message from "commit" if author is missing'</span>
husky &gt; npm run -s precommit (node v9.7.1)

found 0 sensitive files

[issue-107 a7d7b55] fix: Throw meaningful error message from <span class="hljs-string">"commit"</span> <span class="hljs-keyword">if</span> author is missing
 3 files changed, 42 insertions(+), 29 deletions(-)
</code></pre>
<p><a href="https://github.com/typicode/husky">Husky</a> runs a precommit check to make sure no sensitive files like private SSH keys are being committed.
(Husky is just one of many robots I use to help maintain isomorphic-git.)</p>
<p>I push the branch, which triggers another automated scan:</p>
<pre><code class="hljs css language-sh">husky &gt; npm run -s prepush (node v9.7.1)

nps is executing `lint` : nps lint.js &amp;&amp; nps lint.typescript
nps is executing `lint.js` : standard src/**/*.js
nps is executing `lint.typescript` : tsc src/index.d.ts
Counting objects: 9, <span class="hljs-keyword">done</span>.
Delta compression using up to 8 threads.
Compressing objects: 100% (9/9), <span class="hljs-keyword">done</span>.
Writing objects: 100% (9/9), 1.70 KiB | 289.00 KiB/s, <span class="hljs-keyword">done</span>.
Total 9 (delta 8), reused 0 (delta 0)
remote: Resolving deltas: 100% (8/8), completed with 8 <span class="hljs-built_in">local</span> objects.
To https://github.com/isomorphic-git/isomorphic-git
 * [new branch]      issue-107 -&gt; issue-107
Branch issue-107 <span class="hljs-built_in">set</span> up to track remote branch issue-107 from origin.
</code></pre>
<p>(If the linter had found any style problems, it would have fixed them using prettier.
I have not automated amending the commit though, so I would have to fix the commit with
<code>git add -u &amp;&amp; git commit --amend --no-edit</code> and try pushing again.)</p>
<p>Since it succeeded, it will show up on the <a href="https://github.com/isomorphic-git/isomorphic-git">Github page</a>
near the top, under &quot;Your recently pushed branches:&quot;. I go there and click the &quot;Compare &amp; pull request&quot; button.</p>
<p>By default, Github uses the commit message as the PR title, which is usually fine.
However, now I will tack on &quot;(fixes #107)&quot; to the end of the title just so Github automatically creates a hyperlink between
the issue and the PR.</p>
<p>... I lied. Github is not smart enough to use the PR title. :eyeroll:
I edit the PR description to be &quot;fixes #107&quot; and <em>then</em> Github adds the &quot;wmhilton referenced this issue a minute ago&quot; link to the PR to the issue.</p>
<p>Now we wait for the Continuous Integration (CI) system to do its thing.
I didn't actually check if it would work in the browser -
which we could have done by running <code>npm run test</code> (which will run Jasmine and Karma) instead of just <code>jest</code> -
and in fact we didn't run the entire test suite in jest -
but I am pretty confident that the changes I made won't break anything.
The CI system will verify that. It uses <a href="https://travis-ci.org/isomorphic-git/isomorphic-git/">Travis CI</a> and will
run the full gammut of tests, from ensuring the code is in <a href="https://standardjs.com/">Standard Style</a> (which husky already
checked during the pre-push check) to testing it in real browsers via <a href="https://saucelabs.com/open-source">Sauce Labs</a>.
Because Travis-CI creates two builds: one for the 'issue-107' branch as-is and one for the PR which tests how the repo would be
if 'issue-107' is merged into 'master', it takes twice as long. (Because there is a concurrent connection limit with Sauce Labs,
I have to run Travis tests one-at-a-time or risk the Sauce Labs tests timing out.)
It takes about 10 minutes per build, so realistically it will be at least 20-30 minutes before we get the green light to merge the PR.</p>
<p>Not all of the CI statuses have to be green to merge.
Specifically, the required statuses that a commit must pass are:</p>
<ul>
<li>Node Security (a vulnerability scanner)</li>
<li>Snyk (another vulnerability scanner)</li>
<li>Travis CI (unit tests)</li>
</ul>
<p>The optional statuses are:</p>
<ul>
<li>Codecov (test coverage)</li>
<li>bundlesize (whether the bundle size increased)</li>
<li>License Compliance (reports any licensing issues in dependencies)</li>
<li>... and more as I discover more helpful robots and commit scanners</li>
</ul>
<p>Github gives you three choices (Create a merge commit, Squash and merge, or Rebase and merge) when you merge a PR.
I generally go with Squash and Merge because (unlike rebase and merge) it lets you edit the commit message,
and it results in a smaller master branch. It looks like Github has again chosen the commit title, not the PR title, as the suggested Squashed commit message, so I
change &quot;(#118)&quot; to be &quot;(fixes #107, PR #118)&quot; and click &quot;Confirm squash and merge&quot;.</p>
<p>I delete the branch (issue-107) right afterwards, so it doesn't hang around.
Because the commit starts with the keyword &quot;fix:&quot; <a href="https://github.com/semantic-release/semantic-release">semantic-relase</a>
will automatically increment the patch version number and publish the build on npm, in about 10-15 minutes once the CI
tests pass.</p>
<p>Meanwhile, <a href="https://github.com/isomorphic-git/isomorphic-git/issues/107">issue #107</a> has been automatically closed, because our commit had &quot;fixes #107&quot; in its title.
Once semantic-release publishes the release containing this fix, the semantic-release bot will even leave a comment on the issue
(under my name, because of the OAuth token I guess) saying &quot;🎉 This issue has been resolved in version 0.9.9 🎉&quot;.
This is great for both the original bug report contributor, and future users stumbling across the bug report via search engine,
wondering whether their version of isomorphic-git has the fix.</p>
<p>And that is how I do it! Thank you if you read this far. As Mark Twain might have said, &quot;If I had more time, I'd have written a shorter blog post.&quot;</p>
</span></div></article></div><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2018/02/18/introducing-isomorphic-git">Introducing `isomorphic-git`</a></h1><p class="post-meta">February 18, 2018</p><div class="authorBlock"><p class="post-authorName"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener">William Hilton</a></p><div class="authorPhoto"><a href="https://twitter.com/wmhilton" target="_blank" rel="noreferrer noopener"><img src="https://graph.facebook.com/551965935/picture/?height=200&amp;width=200" alt="William Hilton"/></a></div></div></header><article class="post-content"><div><span><p>TODO...</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/isomorphic-git-logo.svg" alt="isomorphic-git" width="66" height="58"/></a><div class="footerSection"><h5>Docs</h5><a href="/docs/en/quickstart">Getting Started</a><a href="/docs/en/alphabetic">API Reference</a></div><div><h5>Community</h5><a href="/en/users">User Showcase</a><a href="https://gitter.im/isomorphic-git/Lobby">Project Chat</a><div><a href="https://github.com/isomorphic-git/isomorphic-git">GitHub <span id="gitHubStars"></span></a><script>
void async function() {
  const response = await fetch('https://api.github.com/repos/isomorphic-git/isomorphic-git', {
    headers: { accept: 'application/vnd.github.v3+json' }
  })
  const data = await response.json()
  document.querySelector('#gitHubStars').textContent = '(' + data.stargazers_count + '⭐)'
}()
</script></div></div><div><h5>More</h5><a href="/docs/en/in-the-news">In The News</a><a href="/blog">Blog</a></div></section><script type="text/javascript">let el = document.querySelector('.navListItemActive'); if (el) el.scrollIntoView({ block: 'nearest' })</script><script type="text/javascript" src="/js/gitter.js"></script><script type="text/javascript" src="/js/sidecar.v1.js"></script><script type="text/javascript" src="/js/codemirrorify.js"></script><script type="text/javascript" src="https://unpkg.com/@isomorphic-git/lightning-fs"></script><script type="text/javascript" src="/js/isomorphic-git/index.umd.min.js"></script><script type="module" src="/js/tutorial.js"></script><script type="module" src="/js/try-it-out-giturl.js"></script><script type="text/javascript" src="https://unpkg.com/@webcomponents/shadydom"></script><script type="text/javascript" src="/js/object-inspector.min.js"></script><script data-domain="isomorphic-git.org" src="https://plausible.io/js/plausible.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ac63b0df4513e31143eef156f520056c',
                indexName: 'isomorphic_git',
                inputSelector: '#search_input_react',
                algoliaOptions: {"typoTolerance":"min","facetFilters":["language:en","version:1.x"]}
              });
            </script></body></html>